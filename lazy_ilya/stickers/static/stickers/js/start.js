var Bn=Object.defineProperty;var Hn=(n,e,t)=>e in n?Bn(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ve=(n,e,t)=>Hn(n,typeof e!="symbol"?e+"":e,t);/* empty css        */import{t as Rn}from"../../cities/js/toggleAccent.js";import{s as Rt}from"./utils.js";/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Vt(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function se(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Vt(Object(t),!0).forEach(function(i){Vn(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Vt(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function Qe(n){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Qe=function(e){return typeof e}:Qe=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qe(n)}function Vn(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function ce(){return ce=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},ce.apply(this,arguments)}function Yn(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,o;for(o=0;o<i.length;o++)r=i[o],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}function jn(n,e){if(n==null)return{};var t=Yn(n,e),i,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(r=0;r<o.length;r++)i=o[r],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(n,i)&&(t[i]=n[i])}return t}var zn="1.15.6";function le(n){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(n)}var de=le(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Re=le(/Edge/i),Yt=le(/firefox/i),Pe=le(/safari/i)&&!le(/chrome/i)&&!le(/android/i),Pt=le(/iP(ad|od|hone)/i),gn=le(/chrome/i)&&le(/android/i),mn={capture:!1,passive:!1};function D(n,e,t){n.addEventListener(e,t,!de&&mn)}function I(n,e,t){n.removeEventListener(e,t,!de&&mn)}function it(n,e){if(e){if(e[0]===">"&&(e=e.substring(1)),n)try{if(n.matches)return n.matches(e);if(n.msMatchesSelector)return n.msMatchesSelector(e);if(n.webkitMatchesSelector)return n.webkitMatchesSelector(e)}catch{return!1}return!1}}function vn(n){return n.host&&n!==document&&n.host.nodeType?n.host:n.parentNode}function ne(n,e,t,i){if(n){t=t||document;do{if(e!=null&&(e[0]===">"?n.parentNode===t&&it(n,e):it(n,e))||i&&n===t)return n;if(n===t)break}while(n=vn(n))}return null}var jt=/\s+/g;function Q(n,e,t){if(n&&e)if(n.classList)n.classList[t?"add":"remove"](e);else{var i=(" "+n.className+" ").replace(jt," ").replace(" "+e+" "," ");n.className=(i+(t?" "+e:"")).replace(jt," ")}}function y(n,e,t){var i=n&&n.style;if(i){if(t===void 0)return document.defaultView&&document.defaultView.getComputedStyle?t=document.defaultView.getComputedStyle(n,""):n.currentStyle&&(t=n.currentStyle),e===void 0?t:t[e];!(e in i)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),i[e]=t+(typeof t=="string"?"":"px")}}function Te(n,e){var t="";if(typeof n=="string")t=n;else do{var i=y(n,"transform");i&&i!=="none"&&(t=i+" "+t)}while(!e&&(n=n.parentNode));var r=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return r&&new r(t)}function bn(n,e,t){if(n){var i=n.getElementsByTagName(e),r=0,o=i.length;if(t)for(;r<o;r++)t(i[r],r);return i}return[]}function oe(){var n=document.scrollingElement;return n||document.documentElement}function H(n,e,t,i,r){if(!(!n.getBoundingClientRect&&n!==window)){var o,s,a,c,l,u,d;if(n!==window&&n.parentNode&&n!==oe()?(o=n.getBoundingClientRect(),s=o.top,a=o.left,c=o.bottom,l=o.right,u=o.height,d=o.width):(s=0,a=0,c=window.innerHeight,l=window.innerWidth,u=window.innerHeight,d=window.innerWidth),(e||t)&&n!==window&&(r=r||n.parentNode,!de))do if(r&&r.getBoundingClientRect&&(y(r,"transform")!=="none"||t&&y(r,"position")!=="static")){var f=r.getBoundingClientRect();s-=f.top+parseInt(y(r,"border-top-width")),a-=f.left+parseInt(y(r,"border-left-width")),c=s+o.height,l=a+o.width;break}while(r=r.parentNode);if(i&&n!==window){var v=Te(r||n),p=v&&v.a,m=v&&v.d;v&&(s/=m,a/=p,d/=p,u/=m,c=s+u,l=a+d)}return{top:s,left:a,bottom:c,right:l,width:d,height:u}}}function zt(n,e,t){for(var i=ge(n,!0),r=H(n)[e];i;){var o=H(i)[t],s=void 0;if(s=r>=o,!s)return i;if(i===oe())break;i=ge(i,!1)}return!1}function Ie(n,e,t,i){for(var r=0,o=0,s=n.children;o<s.length;){if(s[o].style.display!=="none"&&s[o]!==_.ghost&&(i||s[o]!==_.dragged)&&ne(s[o],t.draggable,n,!1)){if(r===e)return s[o];r++}o++}return null}function Nt(n,e){for(var t=n.lastElementChild;t&&(t===_.ghost||y(t,"display")==="none"||e&&!it(t,e));)t=t.previousElementSibling;return t||null}function Z(n,e){var t=0;if(!n||!n.parentNode)return-1;for(;n=n.previousElementSibling;)n.nodeName.toUpperCase()!=="TEMPLATE"&&n!==_.clone&&(!e||it(n,e))&&t++;return t}function Xt(n){var e=0,t=0,i=oe();if(n)do{var r=Te(n),o=r.a,s=r.d;e+=n.scrollLeft*o,t+=n.scrollTop*s}while(n!==i&&(n=n.parentNode));return[e,t]}function Xn(n,e){for(var t in n)if(n.hasOwnProperty(t)){for(var i in e)if(e.hasOwnProperty(i)&&e[i]===n[t][i])return Number(t)}return-1}function ge(n,e){if(!n||!n.getBoundingClientRect)return oe();var t=n,i=!1;do if(t.clientWidth<t.scrollWidth||t.clientHeight<t.scrollHeight){var r=y(t);if(t.clientWidth<t.scrollWidth&&(r.overflowX=="auto"||r.overflowX=="scroll")||t.clientHeight<t.scrollHeight&&(r.overflowY=="auto"||r.overflowY=="scroll")){if(!t.getBoundingClientRect||t===document.body)return oe();if(i||e)return t;i=!0}}while(t=t.parentNode);return oe()}function Kn(n,e){if(n&&e)for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}function pt(n,e){return Math.round(n.top)===Math.round(e.top)&&Math.round(n.left)===Math.round(e.left)&&Math.round(n.height)===Math.round(e.height)&&Math.round(n.width)===Math.round(e.width)}var Ne;function yn(n,e){return function(){if(!Ne){var t=arguments,i=this;t.length===1?n.call(i,t[0]):n.apply(i,t),Ne=setTimeout(function(){Ne=void 0},e)}}}function Gn(){clearTimeout(Ne),Ne=void 0}function _n(n,e,t){n.scrollLeft+=e,n.scrollTop+=t}function wn(n){var e=window.Polymer,t=window.jQuery||window.Zepto;return e&&e.dom?e.dom(n).cloneNode(!0):t?t(n).clone(!0)[0]:n.cloneNode(!0)}function En(n,e,t){var i={};return Array.from(n.children).forEach(function(r){var o,s,a,c;if(!(!ne(r,e.draggable,n,!1)||r.animated||r===t)){var l=H(r);i.left=Math.min((o=i.left)!==null&&o!==void 0?o:1/0,l.left),i.top=Math.min((s=i.top)!==null&&s!==void 0?s:1/0,l.top),i.right=Math.max((a=i.right)!==null&&a!==void 0?a:-1/0,l.right),i.bottom=Math.max((c=i.bottom)!==null&&c!==void 0?c:-1/0,l.bottom)}}),i.width=i.right-i.left,i.height=i.bottom-i.top,i.x=i.left,i.y=i.top,i}var q="Sortable"+new Date().getTime();function Wn(){var n=[],e;return{captureAnimationState:function(){if(n=[],!!this.options.animation){var i=[].slice.call(this.el.children);i.forEach(function(r){if(!(y(r,"display")==="none"||r===_.ghost)){n.push({target:r,rect:H(r)});var o=se({},n[n.length-1].rect);if(r.thisAnimationDuration){var s=Te(r,!0);s&&(o.top-=s.f,o.left-=s.e)}r.fromRect=o}})}},addAnimationState:function(i){n.push(i)},removeAnimationState:function(i){n.splice(Xn(n,{target:i}),1)},animateAll:function(i){var r=this;if(!this.options.animation){clearTimeout(e),typeof i=="function"&&i();return}var o=!1,s=0;n.forEach(function(a){var c=0,l=a.target,u=l.fromRect,d=H(l),f=l.prevFromRect,v=l.prevToRect,p=a.rect,m=Te(l,!0);m&&(d.top-=m.f,d.left-=m.e),l.toRect=d,l.thisAnimationDuration&&pt(f,d)&&!pt(u,d)&&(p.top-d.top)/(p.left-d.left)===(u.top-d.top)/(u.left-d.left)&&(c=Un(p,f,v,r.options)),pt(d,u)||(l.prevFromRect=u,l.prevToRect=d,c||(c=r.options.animation),r.animate(l,p,d,c)),c&&(o=!0,s=Math.max(s,c),clearTimeout(l.animationResetTimer),l.animationResetTimer=setTimeout(function(){l.animationTime=0,l.prevFromRect=null,l.fromRect=null,l.prevToRect=null,l.thisAnimationDuration=null},c),l.thisAnimationDuration=c)}),clearTimeout(e),o?e=setTimeout(function(){typeof i=="function"&&i()},s):typeof i=="function"&&i(),n=[]},animate:function(i,r,o,s){if(s){y(i,"transition",""),y(i,"transform","");var a=Te(this.el),c=a&&a.a,l=a&&a.d,u=(r.left-o.left)/(c||1),d=(r.top-o.top)/(l||1);i.animatingX=!!u,i.animatingY=!!d,y(i,"transform","translate3d("+u+"px,"+d+"px,0)"),this.forRepaintDummy=qn(i),y(i,"transition","transform "+s+"ms"+(this.options.easing?" "+this.options.easing:"")),y(i,"transform","translate3d(0,0,0)"),typeof i.animated=="number"&&clearTimeout(i.animated),i.animated=setTimeout(function(){y(i,"transition",""),y(i,"transform",""),i.animated=!1,i.animatingX=!1,i.animatingY=!1},s)}}}}function qn(n){return n.offsetWidth}function Un(n,e,t,i){return Math.sqrt(Math.pow(e.top-n.top,2)+Math.pow(e.left-n.left,2))/Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))*i.animation}var Se=[],ht={initializeByDefault:!0},Ve={mount:function(e){for(var t in ht)ht.hasOwnProperty(t)&&!(t in e)&&(e[t]=ht[t]);Se.forEach(function(i){if(i.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),Se.push(e)},pluginEvent:function(e,t,i){var r=this;this.eventCanceled=!1,i.cancel=function(){r.eventCanceled=!0};var o=e+"Global";Se.forEach(function(s){t[s.pluginName]&&(t[s.pluginName][o]&&t[s.pluginName][o](se({sortable:t},i)),t.options[s.pluginName]&&t[s.pluginName][e]&&t[s.pluginName][e](se({sortable:t},i)))})},initializePlugins:function(e,t,i,r){Se.forEach(function(a){var c=a.pluginName;if(!(!e.options[c]&&!a.initializeByDefault)){var l=new a(e,t,e.options);l.sortable=e,l.options=e.options,e[c]=l,ce(i,l.defaults)}});for(var o in e.options)if(e.options.hasOwnProperty(o)){var s=this.modifyOption(e,o,e.options[o]);typeof s<"u"&&(e.options[o]=s)}},getEventProperties:function(e,t){var i={};return Se.forEach(function(r){typeof r.eventProperties=="function"&&ce(i,r.eventProperties.call(t[r.pluginName],e))}),i},modifyOption:function(e,t,i){var r;return Se.forEach(function(o){e[o.pluginName]&&o.optionListeners&&typeof o.optionListeners[t]=="function"&&(r=o.optionListeners[t].call(e[o.pluginName],i))}),r}};function Qn(n){var e=n.sortable,t=n.rootEl,i=n.name,r=n.targetEl,o=n.cloneEl,s=n.toEl,a=n.fromEl,c=n.oldIndex,l=n.newIndex,u=n.oldDraggableIndex,d=n.newDraggableIndex,f=n.originalEvent,v=n.putSortable,p=n.extraEventProperties;if(e=e||t&&t[q],!!e){var m,C=e.options,E="on"+i.charAt(0).toUpperCase()+i.substr(1);window.CustomEvent&&!de&&!Re?m=new CustomEvent(i,{bubbles:!0,cancelable:!0}):(m=document.createEvent("Event"),m.initEvent(i,!0,!0)),m.to=s||t,m.from=a||t,m.item=r||t,m.clone=o,m.oldIndex=c,m.newIndex=l,m.oldDraggableIndex=u,m.newDraggableIndex=d,m.originalEvent=f,m.pullMode=v?v.lastPutMode:void 0;var g=se(se({},p),Ve.getEventProperties(i,e));for(var S in g)m[S]=g[S];t&&t.dispatchEvent(m),C[E]&&C[E].call(e,m)}}var Jn=["evt"],W=function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=i.evt,o=jn(i,Jn);Ve.pluginEvent.bind(_)(e,t,se({dragEl:h,parentEl:M,ghostEl:w,rootEl:F,nextEl:Ee,lastDownEl:Je,cloneEl:L,cloneHidden:he,dragStarted:ke,putSortable:V,activeSortable:_.active,originalEvent:r,oldIndex:Ae,oldDraggableIndex:Me,newIndex:J,newDraggableIndex:pe,hideGhostForTarget:xn,unhideGhostForTarget:An,cloneNowHidden:function(){he=!0},cloneNowShown:function(){he=!1},dispatchSortableEvent:function(a){X({sortable:t,name:a,originalEvent:r})}},o))};function X(n){Qn(se({putSortable:V,cloneEl:L,targetEl:h,rootEl:F,oldIndex:Ae,oldDraggableIndex:Me,newIndex:J,newDraggableIndex:pe},n))}var h,M,w,F,Ee,Je,L,he,Ae,J,Me,pe,je,V,xe=!1,rt=!1,ot=[],be,ee,gt,mt,Kt,Gt,ke,Oe,$e,Be=!1,ze=!1,Ze,j,vt=[],It=!1,st=[],ut=typeof document<"u",Xe=Pt,Wt=Re||de?"cssFloat":"float",Zn=ut&&!gn&&!Pt&&"draggable"in document.createElement("div"),Sn=function(){if(ut){if(de)return!1;var n=document.createElement("x");return n.style.cssText="pointer-events:auto",n.style.pointerEvents==="auto"}}(),On=function(e,t){var i=y(e),r=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),o=Ie(e,0,t),s=Ie(e,1,t),a=o&&y(o),c=s&&y(s),l=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+H(o).width,u=c&&parseInt(c.marginLeft)+parseInt(c.marginRight)+H(s).width;if(i.display==="flex")return i.flexDirection==="column"||i.flexDirection==="column-reverse"?"vertical":"horizontal";if(i.display==="grid")return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(o&&a.float&&a.float!=="none"){var d=a.float==="left"?"left":"right";return s&&(c.clear==="both"||c.clear===d)?"vertical":"horizontal"}return o&&(a.display==="block"||a.display==="flex"||a.display==="table"||a.display==="grid"||l>=r&&i[Wt]==="none"||s&&i[Wt]==="none"&&l+u>r)?"vertical":"horizontal"},ei=function(e,t,i){var r=i?e.left:e.top,o=i?e.right:e.bottom,s=i?e.width:e.height,a=i?t.left:t.top,c=i?t.right:t.bottom,l=i?t.width:t.height;return r===a||o===c||r+s/2===a+l/2},ti=function(e,t){var i;return ot.some(function(r){var o=r[q].options.emptyInsertThreshold;if(!(!o||Nt(r))){var s=H(r),a=e>=s.left-o&&e<=s.right+o,c=t>=s.top-o&&t<=s.bottom+o;if(a&&c)return i=r}}),i},Cn=function(e){function t(o,s){return function(a,c,l,u){var d=a.options.group.name&&c.options.group.name&&a.options.group.name===c.options.group.name;if(o==null&&(s||d))return!0;if(o==null||o===!1)return!1;if(s&&o==="clone")return o;if(typeof o=="function")return t(o(a,c,l,u),s)(a,c,l,u);var f=(s?a:c).options.group.name;return o===!0||typeof o=="string"&&o===f||o.join&&o.indexOf(f)>-1}}var i={},r=e.group;(!r||Qe(r)!="object")&&(r={name:r}),i.name=r.name,i.checkPull=t(r.pull,!0),i.checkPut=t(r.put),i.revertClone=r.revertClone,e.group=i},xn=function(){!Sn&&w&&y(w,"display","none")},An=function(){!Sn&&w&&y(w,"display","")};ut&&!gn&&document.addEventListener("click",function(n){if(rt)return n.preventDefault(),n.stopPropagation&&n.stopPropagation(),n.stopImmediatePropagation&&n.stopImmediatePropagation(),rt=!1,!1},!0);var ye=function(e){if(h){e=e.touches?e.touches[0]:e;var t=ti(e.clientX,e.clientY);if(t){var i={};for(var r in e)e.hasOwnProperty(r)&&(i[r]=e[r]);i.target=i.rootEl=t,i.preventDefault=void 0,i.stopPropagation=void 0,t[q]._onDragOver(i)}}},ni=function(e){h&&h.parentNode[q]._isOutsideThisEl(e.target)};function _(n,e){if(!(n&&n.nodeType&&n.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(n));this.el=n,this.options=e=ce({},e),n[q]=this;var t={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(n.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return On(n,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(s,a){s.setData("Text",a.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:_.supportPointer!==!1&&"PointerEvent"in window&&(!Pe||Pt),emptyInsertThreshold:5};Ve.initializePlugins(this,n,t);for(var i in t)!(i in e)&&(e[i]=t[i]);Cn(e);for(var r in this)r.charAt(0)==="_"&&typeof this[r]=="function"&&(this[r]=this[r].bind(this));this.nativeDraggable=e.forceFallback?!1:Zn,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?D(n,"pointerdown",this._onTapStart):(D(n,"mousedown",this._onTapStart),D(n,"touchstart",this._onTapStart)),this.nativeDraggable&&(D(n,"dragover",this),D(n,"dragenter",this)),ot.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),ce(this,Wn())}_.prototype={constructor:_,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(Oe=null)},_getDirection:function(e,t){return typeof this.options.direction=="function"?this.options.direction.call(this,e,t,h):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,i=this.el,r=this.options,o=r.preventOnFilter,s=e.type,a=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,c=(a||e).target,l=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||c,u=r.filter;if(di(i),!h&&!(/mousedown|pointerdown/.test(s)&&e.button!==0||r.disabled)&&!l.isContentEditable&&!(!this.nativeDraggable&&Pe&&c&&c.tagName.toUpperCase()==="SELECT")&&(c=ne(c,r.draggable,i,!1),!(c&&c.animated)&&Je!==c)){if(Ae=Z(c),Me=Z(c,r.draggable),typeof u=="function"){if(u.call(this,e,c,this)){X({sortable:t,rootEl:l,name:"filter",targetEl:c,toEl:i,fromEl:i}),W("filter",t,{evt:e}),o&&e.preventDefault();return}}else if(u&&(u=u.split(",").some(function(d){if(d=ne(l,d.trim(),i,!1),d)return X({sortable:t,rootEl:d,name:"filter",targetEl:c,fromEl:i,toEl:i}),W("filter",t,{evt:e}),!0}),u)){o&&e.preventDefault();return}r.handle&&!ne(l,r.handle,i,!1)||this._prepareDragStart(e,a,c)}}},_prepareDragStart:function(e,t,i){var r=this,o=r.el,s=r.options,a=o.ownerDocument,c;if(i&&!h&&i.parentNode===o){var l=H(i);if(F=o,h=i,M=h.parentNode,Ee=h.nextSibling,Je=i,je=s.group,_.dragged=h,be={target:h,clientX:(t||e).clientX,clientY:(t||e).clientY},Kt=be.clientX-l.left,Gt=be.clientY-l.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,h.style["will-change"]="all",c=function(){if(W("delayEnded",r,{evt:e}),_.eventCanceled){r._onDrop();return}r._disableDelayedDragEvents(),!Yt&&r.nativeDraggable&&(h.draggable=!0),r._triggerDragStart(e,t),X({sortable:r,name:"choose",originalEvent:e}),Q(h,s.chosenClass,!0)},s.ignore.split(",").forEach(function(u){bn(h,u.trim(),bt)}),D(a,"dragover",ye),D(a,"mousemove",ye),D(a,"touchmove",ye),s.supportPointer?(D(a,"pointerup",r._onDrop),!this.nativeDraggable&&D(a,"pointercancel",r._onDrop)):(D(a,"mouseup",r._onDrop),D(a,"touchend",r._onDrop),D(a,"touchcancel",r._onDrop)),Yt&&this.nativeDraggable&&(this.options.touchStartThreshold=4,h.draggable=!0),W("delayStart",this,{evt:e}),s.delay&&(!s.delayOnTouchOnly||t)&&(!this.nativeDraggable||!(Re||de))){if(_.eventCanceled){this._onDrop();return}s.supportPointer?(D(a,"pointerup",r._disableDelayedDrag),D(a,"pointercancel",r._disableDelayedDrag)):(D(a,"mouseup",r._disableDelayedDrag),D(a,"touchend",r._disableDelayedDrag),D(a,"touchcancel",r._disableDelayedDrag)),D(a,"mousemove",r._delayedDragTouchMoveHandler),D(a,"touchmove",r._delayedDragTouchMoveHandler),s.supportPointer&&D(a,"pointermove",r._delayedDragTouchMoveHandler),r._dragStartTimer=setTimeout(c,s.delay)}else c()}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){h&&bt(h),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;I(e,"mouseup",this._disableDelayedDrag),I(e,"touchend",this._disableDelayedDrag),I(e,"touchcancel",this._disableDelayedDrag),I(e,"pointerup",this._disableDelayedDrag),I(e,"pointercancel",this._disableDelayedDrag),I(e,"mousemove",this._delayedDragTouchMoveHandler),I(e,"touchmove",this._delayedDragTouchMoveHandler),I(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||e.pointerType=="touch"&&e,!this.nativeDraggable||t?this.options.supportPointer?D(document,"pointermove",this._onTouchMove):t?D(document,"touchmove",this._onTouchMove):D(document,"mousemove",this._onTouchMove):(D(h,"dragend",this),D(F,"dragstart",this._onDragStart));try{document.selection?et(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,t){if(xe=!1,F&&h){W("dragStarted",this,{evt:t}),this.nativeDraggable&&D(document,"dragover",ni);var i=this.options;!e&&Q(h,i.dragClass,!1),Q(h,i.ghostClass,!0),_.active=this,e&&this._appendGhost(),X({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(ee){this._lastX=ee.clientX,this._lastY=ee.clientY,xn();for(var e=document.elementFromPoint(ee.clientX,ee.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(ee.clientX,ee.clientY),e!==t);)t=e;if(h.parentNode[q]._isOutsideThisEl(e),t)do{if(t[q]){var i=void 0;if(i=t[q]._onDragOver({clientX:ee.clientX,clientY:ee.clientY,target:e,rootEl:t}),i&&!this.options.dragoverBubble)break}e=t}while(t=vn(t));An()}},_onTouchMove:function(e){if(be){var t=this.options,i=t.fallbackTolerance,r=t.fallbackOffset,o=e.touches?e.touches[0]:e,s=w&&Te(w,!0),a=w&&s&&s.a,c=w&&s&&s.d,l=Xe&&j&&Xt(j),u=(o.clientX-be.clientX+r.x)/(a||1)+(l?l[0]-vt[0]:0)/(a||1),d=(o.clientY-be.clientY+r.y)/(c||1)+(l?l[1]-vt[1]:0)/(c||1);if(!_.active&&!xe){if(i&&Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))<i)return;this._onDragStart(e,!0)}if(w){s?(s.e+=u-(gt||0),s.f+=d-(mt||0)):s={a:1,b:0,c:0,d:1,e:u,f:d};var f="matrix(".concat(s.a,",").concat(s.b,",").concat(s.c,",").concat(s.d,",").concat(s.e,",").concat(s.f,")");y(w,"webkitTransform",f),y(w,"mozTransform",f),y(w,"msTransform",f),y(w,"transform",f),gt=u,mt=d,ee=o}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!w){var e=this.options.fallbackOnBody?document.body:F,t=H(h,!0,Xe,!0,e),i=this.options;if(Xe){for(j=e;y(j,"position")==="static"&&y(j,"transform")==="none"&&j!==document;)j=j.parentNode;j!==document.body&&j!==document.documentElement?(j===document&&(j=oe()),t.top+=j.scrollTop,t.left+=j.scrollLeft):j=oe(),vt=Xt(j)}w=h.cloneNode(!0),Q(w,i.ghostClass,!1),Q(w,i.fallbackClass,!0),Q(w,i.dragClass,!0),y(w,"transition",""),y(w,"transform",""),y(w,"box-sizing","border-box"),y(w,"margin",0),y(w,"top",t.top),y(w,"left",t.left),y(w,"width",t.width),y(w,"height",t.height),y(w,"opacity","0.8"),y(w,"position",Xe?"absolute":"fixed"),y(w,"zIndex","100000"),y(w,"pointerEvents","none"),_.ghost=w,e.appendChild(w),y(w,"transform-origin",Kt/parseInt(w.style.width)*100+"% "+Gt/parseInt(w.style.height)*100+"%")}},_onDragStart:function(e,t){var i=this,r=e.dataTransfer,o=i.options;if(W("dragStart",this,{evt:e}),_.eventCanceled){this._onDrop();return}W("setupClone",this),_.eventCanceled||(L=wn(h),L.removeAttribute("id"),L.draggable=!1,L.style["will-change"]="",this._hideClone(),Q(L,this.options.chosenClass,!1),_.clone=L),i.cloneId=et(function(){W("clone",i),!_.eventCanceled&&(i.options.removeCloneOnHide||F.insertBefore(L,h),i._hideClone(),X({sortable:i,name:"clone"}))}),!t&&Q(h,o.dragClass,!0),t?(rt=!0,i._loopId=setInterval(i._emulateDragOver,50)):(I(document,"mouseup",i._onDrop),I(document,"touchend",i._onDrop),I(document,"touchcancel",i._onDrop),r&&(r.effectAllowed="move",o.setData&&o.setData.call(i,r,h)),D(document,"drop",i),y(h,"transform","translateZ(0)")),xe=!0,i._dragStartId=et(i._dragStarted.bind(i,t,e)),D(document,"selectstart",i),ke=!0,window.getSelection().removeAllRanges(),Pe&&y(document.body,"user-select","none")},_onDragOver:function(e){var t=this.el,i=e.target,r,o,s,a=this.options,c=a.group,l=_.active,u=je===c,d=a.sort,f=V||l,v,p=this,m=!1;if(It)return;function C(De,Mn){W(De,p,se({evt:e,isOwner:u,axis:v?"vertical":"horizontal",revert:s,dragRect:r,targetRect:o,canSort:d,fromSortable:f,target:i,completed:g,onMove:function(Ht,$n){return Ke(F,t,h,r,Ht,H(Ht),e,$n)},changed:S},Mn))}function E(){C("dragOverAnimationCapture"),p.captureAnimationState(),p!==f&&f.captureAnimationState()}function g(De){return C("dragOverCompleted",{insertion:De}),De&&(u?l._hideClone():l._showClone(p),p!==f&&(Q(h,V?V.options.ghostClass:l.options.ghostClass,!1),Q(h,a.ghostClass,!0)),V!==p&&p!==_.active?V=p:p===_.active&&V&&(V=null),f===p&&(p._ignoreWhileAnimating=i),p.animateAll(function(){C("dragOverAnimationComplete"),p._ignoreWhileAnimating=null}),p!==f&&(f.animateAll(),f._ignoreWhileAnimating=null)),(i===h&&!h.animated||i===t&&!i.animated)&&(Oe=null),!a.dragoverBubble&&!e.rootEl&&i!==document&&(h.parentNode[q]._isOutsideThisEl(e.target),!De&&ye(e)),!a.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),m=!0}function S(){J=Z(h),pe=Z(h,a.draggable),X({sortable:p,name:"change",toEl:t,newIndex:J,newDraggableIndex:pe,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),i=ne(i,a.draggable,t,!0),C("dragOver"),_.eventCanceled)return m;if(h.contains(e.target)||i.animated&&i.animatingX&&i.animatingY||p._ignoreWhileAnimating===i)return g(!1);if(rt=!1,l&&!a.disabled&&(u?d||(s=M!==F):V===this||(this.lastPutMode=je.checkPull(this,l,h,e))&&c.checkPut(this,l,h,e))){if(v=this._getDirection(e,i)==="vertical",r=H(h),C("dragOverValid"),_.eventCanceled)return m;if(s)return M=F,E(),this._hideClone(),C("revert"),_.eventCanceled||(Ee?F.insertBefore(h,Ee):F.appendChild(h)),g(!0);var x=Nt(t,a.draggable);if(!x||si(e,v,this)&&!x.animated){if(x===h)return g(!1);if(x&&t===e.target&&(i=x),i&&(o=H(i)),Ke(F,t,h,r,i,o,e,!!i)!==!1)return E(),x&&x.nextSibling?t.insertBefore(h,x.nextSibling):t.appendChild(h),M=t,S(),g(!0)}else if(x&&oi(e,v,this)){var $=Ie(t,0,a,!0);if($===h)return g(!1);if(i=$,o=H(i),Ke(F,t,h,r,i,o,e,!1)!==!1)return E(),t.insertBefore(h,$),M=t,S(),g(!0)}else if(i.parentNode===t){o=H(i);var R=0,O,T=h.parentNode!==t,b=!ei(h.animated&&h.toRect||r,i.animated&&i.toRect||o,v),P=v?"top":"left",A=zt(i,"top","top")||zt(h,"top","top"),ie=A?A.scrollTop:void 0;Oe!==i&&(O=o[P],Be=!1,ze=!b&&a.invertSwap||T),R=ai(e,i,o,v,b?1:a.swapThreshold,a.invertedSwapThreshold==null?a.swapThreshold:a.invertedSwapThreshold,ze,Oe===i);var G;if(R!==0){var ae=Z(h);do ae-=R,G=M.children[ae];while(G&&(y(G,"display")==="none"||G===w))}if(R===0||G===i)return g(!1);Oe=i,$e=R;var me=i.nextElementSibling,ue=!1;ue=R===1;var Ye=Ke(F,t,h,r,i,o,e,ue);if(Ye!==!1)return(Ye===1||Ye===-1)&&(ue=Ye===1),It=!0,setTimeout(ri,30),E(),ue&&!me?t.appendChild(h):i.parentNode.insertBefore(h,ue?me:i),A&&_n(A,0,ie-A.scrollTop),M=h.parentNode,O!==void 0&&!ze&&(Ze=Math.abs(O-H(i)[P])),S(),g(!0)}if(t.contains(h))return g(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){I(document,"mousemove",this._onTouchMove),I(document,"touchmove",this._onTouchMove),I(document,"pointermove",this._onTouchMove),I(document,"dragover",ye),I(document,"mousemove",ye),I(document,"touchmove",ye)},_offUpEvents:function(){var e=this.el.ownerDocument;I(e,"mouseup",this._onDrop),I(e,"touchend",this._onDrop),I(e,"pointerup",this._onDrop),I(e,"pointercancel",this._onDrop),I(e,"touchcancel",this._onDrop),I(document,"selectstart",this)},_onDrop:function(e){var t=this.el,i=this.options;if(J=Z(h),pe=Z(h,i.draggable),W("drop",this,{evt:e}),M=h&&h.parentNode,J=Z(h),pe=Z(h,i.draggable),_.eventCanceled){this._nulling();return}xe=!1,ze=!1,Be=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Dt(this.cloneId),Dt(this._dragStartId),this.nativeDraggable&&(I(document,"drop",this),I(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Pe&&y(document.body,"user-select",""),y(h,"transform",""),e&&(ke&&(e.cancelable&&e.preventDefault(),!i.dropBubble&&e.stopPropagation()),w&&w.parentNode&&w.parentNode.removeChild(w),(F===M||V&&V.lastPutMode!=="clone")&&L&&L.parentNode&&L.parentNode.removeChild(L),h&&(this.nativeDraggable&&I(h,"dragend",this),bt(h),h.style["will-change"]="",ke&&!xe&&Q(h,V?V.options.ghostClass:this.options.ghostClass,!1),Q(h,this.options.chosenClass,!1),X({sortable:this,name:"unchoose",toEl:M,newIndex:null,newDraggableIndex:null,originalEvent:e}),F!==M?(J>=0&&(X({rootEl:M,name:"add",toEl:M,fromEl:F,originalEvent:e}),X({sortable:this,name:"remove",toEl:M,originalEvent:e}),X({rootEl:M,name:"sort",toEl:M,fromEl:F,originalEvent:e}),X({sortable:this,name:"sort",toEl:M,originalEvent:e})),V&&V.save()):J!==Ae&&J>=0&&(X({sortable:this,name:"update",toEl:M,originalEvent:e}),X({sortable:this,name:"sort",toEl:M,originalEvent:e})),_.active&&((J==null||J===-1)&&(J=Ae,pe=Me),X({sortable:this,name:"end",toEl:M,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){W("nulling",this),F=h=M=w=Ee=L=Je=he=be=ee=ke=J=pe=Ae=Me=Oe=$e=V=je=_.dragged=_.ghost=_.clone=_.active=null,st.forEach(function(e){e.checked=!0}),st.length=gt=mt=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":h&&(this._onDragOver(e),ii(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],t,i=this.el.children,r=0,o=i.length,s=this.options;r<o;r++)t=i[r],ne(t,s.draggable,this.el,!1)&&e.push(t.getAttribute(s.dataIdAttr)||ci(t));return e},sort:function(e,t){var i={},r=this.el;this.toArray().forEach(function(o,s){var a=r.children[s];ne(a,this.options.draggable,r,!1)&&(i[o]=a)},this),t&&this.captureAnimationState(),e.forEach(function(o){i[o]&&(r.removeChild(i[o]),r.appendChild(i[o]))}),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return ne(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var i=this.options;if(t===void 0)return i[e];var r=Ve.modifyOption(this,e,t);typeof r<"u"?i[e]=r:i[e]=t,e==="group"&&Cn(i)},destroy:function(){W("destroy",this);var e=this.el;e[q]=null,I(e,"mousedown",this._onTapStart),I(e,"touchstart",this._onTapStart),I(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(I(e,"dragover",this),I(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),ot.splice(ot.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!he){if(W("hideClone",this),_.eventCanceled)return;y(L,"display","none"),this.options.removeCloneOnHide&&L.parentNode&&L.parentNode.removeChild(L),he=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(he){if(W("showClone",this),_.eventCanceled)return;h.parentNode==F&&!this.options.group.revertClone?F.insertBefore(L,h):Ee?F.insertBefore(L,Ee):F.appendChild(L),this.options.group.revertClone&&this.animate(h,L),y(L,"display",""),he=!1}}};function ii(n){n.dataTransfer&&(n.dataTransfer.dropEffect="move"),n.cancelable&&n.preventDefault()}function Ke(n,e,t,i,r,o,s,a){var c,l=n[q],u=l.options.onMove,d;return window.CustomEvent&&!de&&!Re?c=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(c=document.createEvent("Event"),c.initEvent("move",!0,!0)),c.to=e,c.from=n,c.dragged=t,c.draggedRect=i,c.related=r||e,c.relatedRect=o||H(e),c.willInsertAfter=a,c.originalEvent=s,n.dispatchEvent(c),u&&(d=u.call(l,c,s)),d}function bt(n){n.draggable=!1}function ri(){It=!1}function oi(n,e,t){var i=H(Ie(t.el,0,t.options,!0)),r=En(t.el,t.options,w),o=10;return e?n.clientX<r.left-o||n.clientY<i.top&&n.clientX<i.right:n.clientY<r.top-o||n.clientY<i.bottom&&n.clientX<i.left}function si(n,e,t){var i=H(Nt(t.el,t.options.draggable)),r=En(t.el,t.options,w),o=10;return e?n.clientX>r.right+o||n.clientY>i.bottom&&n.clientX>i.left:n.clientY>r.bottom+o||n.clientX>i.right&&n.clientY>i.top}function ai(n,e,t,i,r,o,s,a){var c=i?n.clientY:n.clientX,l=i?t.height:t.width,u=i?t.top:t.left,d=i?t.bottom:t.right,f=!1;if(!s){if(a&&Ze<l*r){if(!Be&&($e===1?c>u+l*o/2:c<d-l*o/2)&&(Be=!0),Be)f=!0;else if($e===1?c<u+Ze:c>d-Ze)return-$e}else if(c>u+l*(1-r)/2&&c<d-l*(1-r)/2)return li(e)}return f=f||s,f&&(c<u+l*o/2||c>d-l*o/2)?c>u+l/2?1:-1:0}function li(n){return Z(h)<Z(n)?1:-1}function ci(n){for(var e=n.tagName+n.className+n.src+n.href+n.textContent,t=e.length,i=0;t--;)i+=e.charCodeAt(t);return i.toString(36)}function di(n){st.length=0;for(var e=n.getElementsByTagName("input"),t=e.length;t--;){var i=e[t];i.checked&&st.push(i)}}function et(n){return setTimeout(n,0)}function Dt(n){return clearTimeout(n)}ut&&D(document,"touchmove",function(n){(_.active||xe)&&n.cancelable&&n.preventDefault()});_.utils={on:D,off:I,css:y,find:bn,is:function(e,t){return!!ne(e,t,e,!1)},extend:Kn,throttle:yn,closest:ne,toggleClass:Q,clone:wn,index:Z,nextTick:et,cancelNextTick:Dt,detectDirection:On,getChild:Ie,expando:q};_.get=function(n){return n[q]};_.mount=function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];e[0].constructor===Array&&(e=e[0]),e.forEach(function(i){if(!i.prototype||!i.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(i));i.utils&&(_.utils=se(se({},_.utils),i.utils)),Ve.mount(i)})};_.create=function(n,e){return new _(n,e)};_.version=zn;var B=[],Fe,kt,Ft=!1,yt,_t,at,Le;function ui(){function n(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return n.prototype={dragStarted:function(t){var i=t.originalEvent;this.sortable.nativeDraggable?D(document,"dragover",this._handleAutoScroll):this.options.supportPointer?D(document,"pointermove",this._handleFallbackAutoScroll):i.touches?D(document,"touchmove",this._handleFallbackAutoScroll):D(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var i=t.originalEvent;!this.options.dragOverBubble&&!i.rootEl&&this._handleAutoScroll(i)},drop:function(){this.sortable.nativeDraggable?I(document,"dragover",this._handleAutoScroll):(I(document,"pointermove",this._handleFallbackAutoScroll),I(document,"touchmove",this._handleFallbackAutoScroll),I(document,"mousemove",this._handleFallbackAutoScroll)),qt(),tt(),Gn()},nulling:function(){at=kt=Fe=Ft=Le=yt=_t=null,B.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,i){var r=this,o=(t.touches?t.touches[0]:t).clientX,s=(t.touches?t.touches[0]:t).clientY,a=document.elementFromPoint(o,s);if(at=t,i||this.options.forceAutoScrollFallback||Re||de||Pe){wt(t,this.options,a,i);var c=ge(a,!0);Ft&&(!Le||o!==yt||s!==_t)&&(Le&&qt(),Le=setInterval(function(){var l=ge(document.elementFromPoint(o,s),!0);l!==c&&(c=l,tt()),wt(t,r.options,l,i)},10),yt=o,_t=s)}else{if(!this.options.bubbleScroll||ge(a,!0)===oe()){tt();return}wt(t,this.options,ge(a,!1),!1)}}},ce(n,{pluginName:"scroll",initializeByDefault:!0})}function tt(){B.forEach(function(n){clearInterval(n.pid)}),B=[]}function qt(){clearInterval(Le)}var wt=yn(function(n,e,t,i){if(e.scroll){var r=(n.touches?n.touches[0]:n).clientX,o=(n.touches?n.touches[0]:n).clientY,s=e.scrollSensitivity,a=e.scrollSpeed,c=oe(),l=!1,u;kt!==t&&(kt=t,tt(),Fe=e.scroll,u=e.scrollFn,Fe===!0&&(Fe=ge(t,!0)));var d=0,f=Fe;do{var v=f,p=H(v),m=p.top,C=p.bottom,E=p.left,g=p.right,S=p.width,x=p.height,$=void 0,R=void 0,O=v.scrollWidth,T=v.scrollHeight,b=y(v),P=v.scrollLeft,A=v.scrollTop;v===c?($=S<O&&(b.overflowX==="auto"||b.overflowX==="scroll"||b.overflowX==="visible"),R=x<T&&(b.overflowY==="auto"||b.overflowY==="scroll"||b.overflowY==="visible")):($=S<O&&(b.overflowX==="auto"||b.overflowX==="scroll"),R=x<T&&(b.overflowY==="auto"||b.overflowY==="scroll"));var ie=$&&(Math.abs(g-r)<=s&&P+S<O)-(Math.abs(E-r)<=s&&!!P),G=R&&(Math.abs(C-o)<=s&&A+x<T)-(Math.abs(m-o)<=s&&!!A);if(!B[d])for(var ae=0;ae<=d;ae++)B[ae]||(B[ae]={});(B[d].vx!=ie||B[d].vy!=G||B[d].el!==v)&&(B[d].el=v,B[d].vx=ie,B[d].vy=G,clearInterval(B[d].pid),(ie!=0||G!=0)&&(l=!0,B[d].pid=setInterval((function(){i&&this.layer===0&&_.active._onTouchMove(at);var me=B[this.layer].vy?B[this.layer].vy*a:0,ue=B[this.layer].vx?B[this.layer].vx*a:0;typeof u=="function"&&u.call(_.dragged.parentNode[q],ue,me,n,at,B[this.layer].el)!=="continue"||_n(B[this.layer].el,ue,me)}).bind({layer:d}),24))),d++}while(e.bubbleScroll&&f!==c&&(f=ge(f,!1)));Ft=l}},30),Tn=function(e){var t=e.originalEvent,i=e.putSortable,r=e.dragEl,o=e.activeSortable,s=e.dispatchSortableEvent,a=e.hideGhostForTarget,c=e.unhideGhostForTarget;if(t){var l=i||o;a();var u=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,d=document.elementFromPoint(u.clientX,u.clientY);c(),l&&!l.el.contains(d)&&(s("spill"),this.onSpill({dragEl:r,putSortable:i}))}};function Mt(){}Mt.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,i=e.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var r=Ie(this.sortable.el,this.startIndex,this.options);r?this.sortable.el.insertBefore(t,r):this.sortable.el.appendChild(t),this.sortable.animateAll(),i&&i.animateAll()},drop:Tn};ce(Mt,{pluginName:"revertOnSpill"});function $t(){}$t.prototype={onSpill:function(e){var t=e.dragEl,i=e.putSortable,r=i||this.sortable;r.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),r.animateAll()},drop:Tn};ce($t,{pluginName:"removeOnSpill"});_.mount(new ui);_.mount($t,Mt);class fi{constructor({addButtonId:e,boardId:t,colors:i=[]}){this.addCardBtn=document.getElementById(e),this.noteBoard=document.getElementById(t),this.csrfToken=document.querySelector("[name=csrfmiddlewaretoken]").value,this.colors=i.length?i:["#FFEB3B","#FFCDD2","#C8E6C9","#BBDEFB","#FFF9C4","#FFE0B2"],this.addCardBtn.addEventListener("click",()=>this.showColorPicker()),this.authors=[username,...username_data.filter(r=>r.username!==username&&r.first_name!==username).map(r=>r.first_name.trim()!==""?r.first_name:r.username),"Всем!"],this.currentAuthorIndex=0,this.noteData=notes_data,this.initSortable()}initSortable(){_.create(this.noteBoard,{animation:500,handle:".note-card",ghostClass:"opacity-50",onEnd:()=>this.updateNoteOrders()})}loadInitialNotes(){Array.isArray(this.noteData)&&this.noteData.forEach(e=>this.buildNoteCard(e))}showColorPicker(){if(document.getElementById("color-picker"))return;const e=document.createElement("div");e.id="color-picker",e.className="fixed bottom-25 right-7 bg-white p-2.5 rounded-lg shadow-md flex gap-2.5 z-[9999]",this.colors.forEach(i=>{const r=document.createElement("div");r.style.backgroundColor=i,r.className="w-7.5 h-7.5 rounded-md cursor-pointer",r.title=i,r.addEventListener("click",()=>{this.buildNoteCard({color:i}),e.remove()}),e.appendChild(r)}),document.body.appendChild(e);const t=i=>{e.contains(i.target)||(e.remove(),document.removeEventListener("click",t))};setTimeout(()=>document.addEventListener("click",t),0)}buildNoteCard({id:e,text:t="Новая заметка...",color:i="#FFEB3B",author_name:r=this.authors[0],owner:o=username,order:s,width:a,height:c},l=username){const u=document.createElement("div");u.className="note-card",u.style.backgroundColor=i,a&&(u.style.width=`${a}px`),c&&(u.style.height=`${c}px`),e!==void 0&&(u.dataset.id=e),o!==void 0&&(u.dataset.user=o),u.dataset.order=s??this.noteBoard.children.length;const d=document.createElement("button");d.className="relative author-btn",d.textContent=r;const f=document.createElement("div");f.className="dropdown  opacity-0 scale-y-0 invisible",document.body.appendChild(f);let v;const p=()=>{clearTimeout(v),f.classList.add("opacity-0","scale-y-0","invisible"),f.classList.remove("opacity-100","scale-y-100","visible")},m=()=>{clearTimeout(v),v=setTimeout(p,5e3)},C=()=>{const x=d.getBoundingClientRect();f.style.top=`${x.bottom+4+window.scrollY}px`,f.style.left=`${x.right-f.offsetWidth+window.scrollX}px`,f.classList.remove("opacity-0","scale-y-0","invisible"),f.classList.add("opacity-100","scale-y-100","visible"),m()};this.authors.forEach(x=>{const $=document.createElement("div");$.textContent=x,$.addEventListener("click",()=>{d.textContent=x,p(),this.sendNoteUpdate(u)}),f.appendChild($)}),l===o?(d.addEventListener("click",x=>{x.stopPropagation(),f.classList.contains("invisible")?C():p()}),f.addEventListener("mouseenter",m)):(d.disabled=!0,d.title="Вы не можете менять автора этой заметки"),document.addEventListener("click",x=>{!f.contains(x.target)&&!d.contains(x.target)&&p()});const E=document.createElement("div");E.className="flex justify-end mb-1",E.appendChild(d);const g=document.createElement("div");g.className="content-area ",g.contentEditable=!0,g.spellcheck=!1,g.innerHTML=t,g.addEventListener("blur",()=>this.sendNoteUpdate(u));const S=document.createElement("button");return S.textContent="×",S.title="Удалить заметку",S.className="delete-btn",l===o||l===r?S.addEventListener("click",x=>{x.stopPropagation();const $=u.dataset.id;$&&this.deleteNoteFromServer($),u.remove()}):(S.disabled=!0,S.title="Вы не можете удалить заметку, вы ее не создавали"),u.append(E,g,S),u.addEventListener("click",x=>{x.target.classList.contains("delete-btn")||g.focus()}),g.addEventListener("input",()=>{u.style.height="",u.style.width=""}),this.noteBoard.appendChild(u),e||this.sendNoteCreate(u,{text:g.innerHTML,color:u.style.backgroundColor,author_name:d.textContent}),u}async sendNoteCreate(e,t){const i={text:t.text,color:t.color,author_name:t.author_name,width:e.offsetWidth,height:e.offsetHeight,order:[...this.noteBoard.children].indexOf(e)};try{const r=await fetch("",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.csrfToken},body:JSON.stringify(i)}),o=await r.json();if(!r.ok)throw o;const s=o.data??o;e.setAttribute("data-id",s.id),e.setAttribute("data-user",username),this.showSuccessMessage(`Заметка создана: ${s.id}`)}catch(r){this.handleServerError(r,"Не удалось создать заметку")}}async sendNoteUpdate(e){const t=e.getAttribute("data-id");if(!t)return;const i=e.querySelector("[contenteditable]"),r=e.querySelector(".author-btn"),o=[...this.noteBoard.children].indexOf(e),s={id:t,text:i.innerHTML,color:e.style.backgroundColor,author_name:r.textContent,width:e.offsetWidth,height:e.offsetHeight,order:o};try{const a=await fetch("",{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRFToken":this.csrfToken},body:JSON.stringify(s)}),c=await a.json();if(!a.ok)throw c;e.setAttribute("data-order",o)}catch(a){this.handleServerError(a,"Не удалось обновить заметку")}}async deleteNoteFromServer(e){try{const t=await fetch(`${e}/`,{method:"DELETE",headers:{"X-CSRFToken":this.csrfToken}});if(!t.ok)throw await t.json();const i=this.noteBoard.querySelector(`[data-id="${e}"]`);i&&i.remove(),this.showSuccessMessage(`Заметка ${e} удалена`)}catch(t){this.handleServerError(t,"Не удалось удалить заметку")}}showSuccessMessage(e){const t=document.getElementById("server-info"),i=t.querySelector("p");this.successMessageTimeout&&clearTimeout(this.successMessageTimeout),t.classList.remove("hidden","animate-popup-reverse"),t.classList.add("flex","animate-popup"),i.textContent=e,t.scrollIntoView({behavior:"smooth",block:"start"}),this.successMessageTimeout=setTimeout(()=>{t.classList.remove("animate-popup"),t.classList.add("animate-popup-reverse"),setTimeout(()=>{t.classList.add("hidden"),t.classList.remove("flex","animate-popup-reverse")},1e3),this.successMessageTimeout=null},5e3)}updateNoteOrders(){[...this.noteBoard.children].forEach((e,t)=>{parseInt(e.getAttribute("data-order"))!==t&&(e.setAttribute("data-order",t),this.sendNoteUpdate(e))})}handleServerError(e,t){if(console.error(t,e),e!=null&&e.errors)for(const[i,r]of Object.entries(e.errors))r.forEach(o=>{Rt(`Ошибка в поле "${i}" - "${o}"`)});else Rt(t)}}function Et(n,e){n.split(/\s+/).forEach(t=>{e(t)})}class pi{constructor(){this._events={}}on(e,t){Et(e,i=>{const r=this._events[i]||[];r.push(t),this._events[i]=r})}off(e,t){var i=arguments.length;if(i===0){this._events={};return}Et(e,r=>{if(i===1){delete this._events[r];return}const o=this._events[r];o!==void 0&&(o.splice(o.indexOf(t),1),this._events[r]=o)})}trigger(e,...t){var i=this;Et(e,r=>{const o=i._events[r];o!==void 0&&o.forEach(s=>{s.apply(i,t)})})}}function hi(n){return n.plugins={},class extends n{constructor(){super(...arguments),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,t){n.plugins[e]={name:e,fn:t}}initializePlugins(e){var t,i;const r=this,o=[];if(Array.isArray(e))e.forEach(s=>{typeof s=="string"?o.push(s):(r.plugins.settings[s.name]=s.options,o.push(s.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(r.plugins.settings[t]=e[t],o.push(t));for(;i=o.shift();)r.require(i)}loadPlugin(e){var t=this,i=t.plugins,r=n.plugins[e];if(!n.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');i.requested[e]=!0,i.loaded[e]=r.fn.apply(t,[t.plugins.settings[e]||{}]),i.names.push(e)}require(e){var t=this,i=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(i.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return i.loaded[e]}}}const ft=n=>(n=n.filter(Boolean),n.length<2?n[0]||"":mi(n)==1?"["+n.join("")+"]":"(?:"+n.join("|")+")"),In=n=>{if(!gi(n))return n.join("");let e="",t=0;const i=()=>{t>1&&(e+="{"+t+"}")};return n.forEach((r,o)=>{if(r===n[o-1]){t++;return}i(),e+=r,t=1}),i(),e},Dn=n=>{let e=Array.from(n);return ft(e)},gi=n=>new Set(n).size!==n.length,He=n=>(n+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),mi=n=>n.reduce((e,t)=>Math.max(e,vi(t)),0),vi=n=>Array.from(n).length,kn=n=>{if(n.length===1)return[[n]];let e=[];const t=n.substring(1);return kn(t).forEach(function(r){let o=r.slice(0);o[0]=n.charAt(0)+o[0],e.push(o),o=r.slice(0),o.unshift(n.charAt(0)),e.push(o)}),e},bi=[[0,65535]],yi="[̀-ͯ·ʾʼ]";let lt,Fn;const _i=3,Bt={},Ut={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(let n in Ut){let e=Ut[n]||"";for(let t=0;t<e.length;t++){let i=e.substring(t,t+1);Bt[i]=n}}const wi=new RegExp(Object.keys(Bt).join("|")+"|"+yi,"gu"),Ei=n=>{lt===void 0&&(lt=xi(bi))},Qt=(n,e="NFKD")=>n.normalize(e),ct=n=>Array.from(n).reduce((e,t)=>e+Si(t),""),Si=n=>(n=Qt(n).toLowerCase().replace(wi,e=>Bt[e]||""),Qt(n,"NFC"));function*Oi(n){for(const[e,t]of n)for(let i=e;i<=t;i++){let r=String.fromCharCode(i),o=ct(r);o!=r.toLowerCase()&&(o.length>_i||o.length!=0&&(yield{folded:o,composed:r,code_point:i}))}}const Ci=n=>{const e={},t=(i,r)=>{const o=e[i]||new Set,s=new RegExp("^"+Dn(o)+"$","iu");r.match(s)||(o.add(He(r)),e[i]=o)};for(let i of Oi(n))t(i.folded,i.folded),t(i.folded,i.composed);return e},xi=n=>{const e=Ci(n),t={};let i=[];for(let o in e){let s=e[o];s&&(t[o]=Dn(s)),o.length>1&&i.push(He(o))}i.sort((o,s)=>s.length-o.length);const r=ft(i);return Fn=new RegExp("^"+r,"u"),t},Ai=(n,e=1)=>{let t=0;return n=n.map(i=>(lt[i]&&(t+=i.length),lt[i]||i)),t>=e?In(n):""},Ti=(n,e=1)=>(e=Math.max(e,n.length-1),ft(kn(n).map(t=>Ai(t,e)))),Jt=(n,e=!0)=>{let t=n.length>1?1:0;return ft(n.map(i=>{let r=[];const o=e?i.length():i.length()-1;for(let s=0;s<o;s++)r.push(Ti(i.substrs[s]||"",t));return In(r)}))},Ii=(n,e)=>{for(const t of e){if(t.start!=n.start||t.end!=n.end||t.substrs.join("")!==n.substrs.join(""))continue;let i=n.parts;const r=s=>{for(const a of i){if(a.start===s.start&&a.substr===s.substr)return!1;if(!(s.length==1||a.length==1)&&(s.start<a.start&&s.end>a.start||a.start<s.start&&a.end>s.start))return!0}return!1};if(!(t.parts.filter(r).length>0))return!0}return!1};class dt{constructor(){ve(this,"parts");ve(this,"substrs");ve(this,"start");ve(this,"end");this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,t){let i=new dt,r=JSON.parse(JSON.stringify(this.parts)),o=r.pop();for(const c of r)i.add(c);let s=t.substr.substring(0,e-o.start),a=s.length;return i.add({start:o.start,end:o.start+a,length:a,substr:s}),i}}const Di=n=>{Ei(),n=ct(n);let e="",t=[new dt];for(let i=0;i<n.length;i++){let o=n.substring(i).match(Fn);const s=n.substring(i,i+1),a=o?o[0]:null;let c=[],l=new Set;for(const u of t){const d=u.last();if(!d||d.length==1||d.end<=i)if(a){const f=a.length;u.add({start:i,end:i+f,length:f,substr:a}),l.add("1")}else u.add({start:i,end:i+1,length:1,substr:s}),l.add("2");else if(a){let f=u.clone(i,d);const v=a.length;f.add({start:i,end:i+v,length:v,substr:a}),c.push(f)}else l.add("3")}if(c.length>0){c=c.sort((u,d)=>u.length()-d.length());for(let u of c)Ii(u,t)||t.push(u);continue}if(i>0&&l.size==1&&!l.has("3")){e+=Jt(t,!1);let u=new dt;const d=t[0];d&&u.add(d.last()),t=[u]}}return e+=Jt(t,!0),e},ki=(n,e)=>{if(n)return n[e]},Fi=(n,e)=>{if(n){for(var t,i=e.split(".");(t=i.shift())&&(n=n[t]););return n}},St=(n,e,t)=>{var i,r;return!n||(n=n+"",e.regex==null)||(r=n.search(e.regex),r===-1)?0:(i=e.string.length/n.length,r===0&&(i+=.5),i*t)},Ot=(n,e)=>{var t=n[e];if(typeof t=="function")return t;t&&!Array.isArray(t)&&(n[e]=[t])},Ge=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},Li=(n,e)=>typeof n=="number"&&typeof e=="number"?n>e?1:n<e?-1:0:(n=ct(n+"").toLowerCase(),e=ct(e+"").toLowerCase(),n>e?1:e>n?-1:0);class Pi{constructor(e,t){ve(this,"items");ve(this,"settings");this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t,i){if(!e||!e.length)return[];const r=[],o=e.split(/\s+/);var s;return i&&(s=new RegExp("^("+Object.keys(i).map(He).join("|")+"):(.*)$")),o.forEach(a=>{let c,l=null,u=null;s&&(c=a.match(s))&&(l=c[1],a=c[2]),a.length>0&&(this.settings.diacritics?u=Di(a)||null:u=He(a),u&&t&&(u="\\b"+u)),r.push({string:a,regex:u?new RegExp(u,"iu"):null,field:l})}),r}getScoreFunction(e,t){var i=this.prepareSearch(e,t);return this._getScoreFunction(i)}_getScoreFunction(e){const t=e.tokens,i=t.length;if(!i)return function(){return 0};const r=e.options.fields,o=e.weights,s=r.length,a=e.getAttrFn;if(!s)return function(){return 1};const c=function(){return s===1?function(l,u){const d=r[0].field;return St(a(u,d),l,o[d]||1)}:function(l,u){var d=0;if(l.field){const f=a(u,l.field);!l.regex&&f?d+=1/s:d+=St(f,l,1)}else Ge(o,(f,v)=>{d+=St(a(u,v),l,f)});return d/s}}();return i===1?function(l){return c(t[0],l)}:e.options.conjunction==="and"?function(l){var u,d=0;for(let f of t){if(u=c(f,l),u<=0)return 0;d+=u}return d/i}:function(l){var u=0;return Ge(t,d=>{u+=c(d,l)}),u/i}}getSortFunction(e,t){var i=this.prepareSearch(e,t);return this._getSortFunction(i)}_getSortFunction(e){var t,i=[];const r=this,o=e.options,s=!e.query&&o.sort_empty?o.sort_empty:o.sort;if(typeof s=="function")return s.bind(this);const a=function(l,u){return l==="$score"?u.score:e.getAttrFn(r.items[u.id],l)};if(s)for(let l of s)(e.query||l.field!=="$score")&&i.push(l);if(e.query){t=!0;for(let l of i)if(l.field==="$score"){t=!1;break}t&&i.unshift({field:"$score",direction:"desc"})}else i=i.filter(l=>l.field!=="$score");return i.length?function(l,u){var d,f;for(let v of i)if(f=v.field,d=(v.direction==="desc"?-1:1)*Li(a(f,l),a(f,u)),d)return d;return 0}:null}prepareSearch(e,t){const i={};var r=Object.assign({},t);if(Ot(r,"sort"),Ot(r,"sort_empty"),r.fields){Ot(r,"fields");const o=[];r.fields.forEach(s=>{typeof s=="string"&&(s={field:s,weight:1}),o.push(s),i[s.field]="weight"in s?s.weight:1}),r.fields=o}return{options:r,query:e.toLowerCase().trim(),tokens:this.tokenize(e,r.respect_word_boundaries,i),total:0,items:[],weights:i,getAttrFn:r.nesting?Fi:ki}}search(e,t){var i=this,r,o;o=this.prepareSearch(e,t),t=o.options,e=o.query;const s=t.score||i._getScoreFunction(o);e.length?Ge(i.items,(c,l)=>{r=s(c),(t.filter===!1||r>0)&&o.items.push({score:r,id:l})}):Ge(i.items,(c,l)=>{o.items.push({score:1,id:l})});const a=i._getSortFunction(o);return a&&o.items.sort(a),o.total=o.items.length,typeof t.limit=="number"&&(o.items=o.items.slice(0,t.limit)),o}}const te=n=>typeof n>"u"||n===null?null:nt(n),nt=n=>typeof n=="boolean"?n?"1":"0":n+"",Ct=n=>(n+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),Ni=(n,e)=>e>0?window.setTimeout(n,e):(n.call(null),null),Mi=(n,e)=>{var t;return function(i,r){var o=this;t&&(o.loading=Math.max(o.loading-1,0),clearTimeout(t)),t=setTimeout(function(){t=null,o.loadedSearches[i]=!0,n.call(o,i,r)},e)}},Zt=(n,e,t)=>{var i,r=n.trigger,o={};n.trigger=function(){var s=arguments[0];if(e.indexOf(s)!==-1)o[s]=arguments;else return r.apply(n,arguments)},t.apply(n,[]),n.trigger=r;for(i of e)i in o&&r.apply(n,o[i])},$i=n=>({start:n.selectionStart||0,length:(n.selectionEnd||0)-(n.selectionStart||0)}),N=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},z=(n,e,t,i)=>{n.addEventListener(e,t,i)},_e=(n,e)=>{if(!e||!e[n])return!1;var t=(e.altKey?1:0)+(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.metaKey?1:0);return t===1},xt=(n,e)=>{const t=n.getAttribute("id");return t||(n.setAttribute("id",e),e)},en=n=>n.replace(/[\\"']/g,"\\$&"),we=(n,e)=>{e&&n.append(e)},Y=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},re=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(Ln(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},Ln=n=>typeof n=="string"&&n.indexOf("<")>-1,Bi=n=>n.replace(/['"\\]/g,"\\$&"),At=(n,e)=>{var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!1),n.dispatchEvent(t)},We=(n,e)=>{Object.assign(n.style,e)},U=(n,...e)=>{var t=Pn(e);n=Nn(n),n.map(i=>{t.map(r=>{i.classList.add(r)})})},fe=(n,...e)=>{var t=Pn(e);n=Nn(n),n.map(i=>{t.map(r=>{i.classList.remove(r)})})},Pn=n=>{var e=[];return Y(n,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},Nn=n=>(Array.isArray(n)||(n=[n]),n),Tt=(n,e,t)=>{if(!(t&&!t.contains(n)))for(;n&&n.matches;){if(n.matches(e))return n;n=n.parentNode}},tn=(n,e=0)=>e>0?n[n.length-1]:n[0],Hi=n=>Object.keys(n).length===0,nn=(n,e)=>{if(!n)return-1;e=e||n.nodeName;for(var t=0;n=n.previousElementSibling;)n.matches(e)&&t++;return t},k=(n,e)=>{Y(e,(t,i)=>{t==null?n.removeAttribute(i):n.setAttribute(i,""+t)})},Lt=(n,e)=>{n.parentNode&&n.parentNode.replaceChild(e,n)},Ri=(n,e)=>{if(e===null)return;if(typeof e=="string"){if(!e.length)return;e=new RegExp(e,"i")}const t=o=>{var s=o.data.match(e);if(s&&o.data.length>0){var a=document.createElement("span");a.className="highlight";var c=o.splitText(s.index);c.splitText(s[0].length);var l=c.cloneNode(!0);return a.appendChild(l),Lt(c,a),1}return 0},i=o=>{o.nodeType===1&&o.childNodes&&!/(script|style)/i.test(o.tagName)&&(o.className!=="highlight"||o.tagName!=="SPAN")&&Array.from(o.childNodes).forEach(s=>{r(s)})},r=o=>o.nodeType===3?t(o):(i(o),0);r(n)},Vi=n=>{var e=n.querySelectorAll("span.highlight");Array.prototype.forEach.call(e,function(t){var i=t.parentNode;i.replaceChild(t.firstChild,t),i.normalize()})},Yi=65,ji=13,zi=27,Xi=37,Ki=38,Gi=39,Wi=40,rn=8,qi=46,on=9,Ui=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),qe=Ui?"metaKey":"ctrlKey",sn={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,refreshThrottle:300,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(n){return n.length>0},render:{}};function an(n,e){var t=Object.assign({},sn,e),i=t.dataAttr,r=t.labelField,o=t.valueField,s=t.disabledField,a=t.optgroupField,c=t.optgroupLabelField,l=t.optgroupValueField,u=n.tagName.toLowerCase(),d=n.getAttribute("placeholder")||n.getAttribute("data-placeholder");if(!d&&!t.allowEmptyOption){let m=n.querySelector('option[value=""]');m&&(d=m.textContent)}var f={placeholder:d,options:[],optgroups:[],items:[],maxItems:null},v=()=>{var m,C=f.options,E={},g=1;let S=0;var x=O=>{var T=Object.assign({},O.dataset),b=i&&T[i];return typeof b=="string"&&b.length&&(T=Object.assign(T,JSON.parse(b))),T},$=(O,T)=>{var b=te(O.value);if(b!=null&&!(!b&&!t.allowEmptyOption)){if(E.hasOwnProperty(b)){if(T){var P=E[b][a];P?Array.isArray(P)?P.push(T):E[b][a]=[P,T]:E[b][a]=T}}else{var A=x(O);A[r]=A[r]||O.textContent,A[o]=A[o]||b,A[s]=A[s]||O.disabled,A[a]=A[a]||T,A.$option=O,A.$order=A.$order||++S,E[b]=A,C.push(A)}O.selected&&f.items.push(b)}},R=O=>{var T,b;b=x(O),b[c]=b[c]||O.getAttribute("label")||"",b[l]=b[l]||g++,b[s]=b[s]||O.disabled,b.$order=b.$order||++S,f.optgroups.push(b),T=b[l],Y(O.children,P=>{$(P,T)})};f.maxItems=n.hasAttribute("multiple")?null:1,Y(n.children,O=>{m=O.tagName.toLowerCase(),m==="optgroup"?R(O):m==="option"&&$(O)})},p=()=>{const m=n.getAttribute(i);if(m)f.options=JSON.parse(m),Y(f.options,E=>{f.items.push(E[o])});else{var C=n.value.trim()||"";if(!t.allowEmptyOption&&!C.length)return;const E=C.split(t.delimiter);Y(E,g=>{const S={};S[r]=g,S[o]=g,f.options.push(S)}),f.items=E}};return u==="select"?v():p(),Object.assign({},sn,f,e)}var ln=0;class K extends hi(pi){constructor(e,t){super(),this.order=0,this.isOpen=!1,this.isDisabled=!1,this.isReadOnly=!1,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],this.refreshTimeout=null,ln++;var i,r=re(e);if(r.tomselect)throw new Error("Tom Select already initialized on this element");r.tomselect=this;var o=window.getComputedStyle&&window.getComputedStyle(r,null);i=o.getPropertyValue("direction");const s=an(r,t);this.settings=s,this.input=r,this.tabIndex=r.tabIndex||0,this.is_select_tag=r.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(i),this.inputId=xt(r,"tomselect-"+ln),this.isRequired=r.required,this.sifter=new Pi(this.options,{diacritics:s.diacritics}),s.mode=s.mode||(s.maxItems===1?"single":"multi"),typeof s.hideSelected!="boolean"&&(s.hideSelected=s.mode==="multi"),typeof s.hidePlaceholder!="boolean"&&(s.hidePlaceholder=s.mode!=="multi");var a=s.createFilter;typeof a!="function"&&(typeof a=="string"&&(a=new RegExp(a)),a instanceof RegExp?s.createFilter=C=>a.test(C):s.createFilter=C=>this.settings.duplicates||!this.options[C]),this.initializePlugins(s.plugins),this.setupCallbacks(),this.setupTemplates();const c=re("<div>"),l=re("<div>"),u=this._render("dropdown"),d=re('<div role="listbox" tabindex="-1">'),f=this.input.getAttribute("class")||"",v=s.mode;var p;if(U(c,s.wrapperClass,f,v),U(l,s.controlClass),we(c,l),U(u,s.dropdownClass,v),s.copyClassesToDropdown&&U(u,f),U(d,s.dropdownContentClass),we(u,d),re(s.dropdownParent||c).appendChild(u),Ln(s.controlInput)){p=re(s.controlInput);var m=["autocorrect","autocapitalize","autocomplete","spellcheck"];Y(m,C=>{r.getAttribute(C)&&k(p,{[C]:r.getAttribute(C)})}),p.tabIndex=-1,l.appendChild(p),this.focus_node=p}else s.controlInput?(p=re(s.controlInput),this.focus_node=p):(p=re("<input/>"),this.focus_node=l);this.wrapper=c,this.dropdown=u,this.dropdown_content=d,this.control=l,this.control_input=p,this.setup()}setup(){const e=this,t=e.settings,i=e.control_input,r=e.dropdown,o=e.dropdown_content,s=e.wrapper,a=e.control,c=e.input,l=e.focus_node,u={passive:!0},d=e.inputId+"-ts-dropdown";k(o,{id:d}),k(l,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":d});const f=xt(l,e.inputId+"-ts-control"),v="label[for='"+Bi(e.inputId)+"']",p=document.querySelector(v),m=e.focus.bind(e);if(p){z(p,"click",m),k(p,{for:f});const g=xt(p,e.inputId+"-ts-label");k(l,{"aria-labelledby":g}),k(o,{"aria-labelledby":g})}if(s.style.width=c.style.width,e.plugins.names.length){const g="plugin-"+e.plugins.names.join(" plugin-");U([s,r],g)}(t.maxItems===null||t.maxItems>1)&&e.is_select_tag&&k(c,{multiple:"multiple"}),t.placeholder&&k(i,{placeholder:t.placeholder}),!t.splitOn&&t.delimiter&&(t.splitOn=new RegExp("\\s*"+He(t.delimiter)+"+\\s*")),t.load&&t.loadThrottle&&(t.load=Mi(t.load,t.loadThrottle)),z(r,"mousemove",()=>{e.ignoreHover=!1}),z(r,"mouseenter",g=>{var S=Tt(g.target,"[data-selectable]",r);S&&e.onOptionHover(g,S)},{capture:!0}),z(r,"click",g=>{const S=Tt(g.target,"[data-selectable]");S&&(e.onOptionSelect(g,S),N(g,!0))}),z(a,"click",g=>{var S=Tt(g.target,"[data-ts-item]",a);if(S&&e.onItemSelect(g,S)){N(g,!0);return}i.value==""&&(e.onClick(),N(g,!0))}),z(l,"keydown",g=>e.onKeyDown(g)),z(i,"keypress",g=>e.onKeyPress(g)),z(i,"input",g=>e.onInput(g)),z(l,"blur",g=>e.onBlur(g)),z(l,"focus",g=>e.onFocus(g)),z(i,"paste",g=>e.onPaste(g));const C=g=>{const S=g.composedPath()[0];if(!s.contains(S)&&!r.contains(S)){e.isFocused&&e.blur(),e.inputState();return}S==i&&e.isOpen?g.stopPropagation():N(g,!0)},E=()=>{e.isOpen&&e.positionDropdown()};z(document,"mousedown",C),z(window,"scroll",E,u),z(window,"resize",E,u),this._destroy=()=>{document.removeEventListener("mousedown",C),window.removeEventListener("scroll",E),window.removeEventListener("resize",E),p&&p.removeEventListener("click",m)},this.revertSettings={innerHTML:c.innerHTML,tabIndex:c.tabIndex},c.tabIndex=-1,c.insertAdjacentElement("afterend",e.wrapper),e.sync(!1),t.items=[],delete t.optgroups,delete t.options,z(c,"invalid",()=>{e.isValid&&(e.isValid=!1,e.isInvalid=!0,e.refreshState())}),e.updateOriginalInput(),e.refreshItems(),e.close(!1),e.inputState(),e.isSetup=!0,c.disabled?e.disable():c.readOnly?e.setReadOnly(!0):e.enable(),e.on("change",this.onChange),U(c,"tomselected","ts-hidden-accessible"),e.trigger("initialize"),t.preload===!0&&e.preload()}setupOptions(e=[],t=[]){this.addOptions(e),Y(t,i=>{this.registerOptionGroup(i)})}setupTemplates(){var e=this,t=e.settings.labelField,i=e.settings.optgroupLabelField,r={optgroup:o=>{let s=document.createElement("div");return s.className="optgroup",s.appendChild(o.options),s},optgroup_header:(o,s)=>'<div class="optgroup-header">'+s(o[i])+"</div>",option:(o,s)=>"<div>"+s(o[t])+"</div>",item:(o,s)=>"<div>"+s(o[t])+"</div>",option_create:(o,s)=>'<div class="create">Add <strong>'+s(o.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},r,e.settings.render)}setupCallbacks(){var e,t,i={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in i)t=this.settings[i[e]],t&&this.on(e,t)}sync(e=!0){const t=this,i=e?an(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(i.options,i.optgroups),t.setValue(i.items||[],!0),t.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){At(this.input,"input"),At(this.input,"change")}onPaste(e){var t=this;if(t.isInputHidden||t.isLocked){N(e);return}t.settings.splitOn&&setTimeout(()=>{var i=t.inputValue();if(i.match(t.settings.splitOn)){var r=i.trim().split(t.settings.splitOn);Y(r,o=>{te(o)&&(this.options[o]?t.addItem(o):t.createItem(o))})}},0)}onKeyPress(e){var t=this;if(t.isLocked){N(e);return}var i=String.fromCharCode(e.keyCode||e.which);if(t.settings.create&&t.settings.mode==="multi"&&i===t.settings.delimiter){t.createItem(),N(e);return}}onKeyDown(e){var t=this;if(t.ignoreHover=!0,t.isLocked){e.keyCode!==on&&N(e);return}switch(e.keyCode){case Yi:if(_e(qe,e)&&t.control_input.value==""){N(e),t.selectAll();return}break;case zi:t.isOpen&&(N(e,!0),t.close()),t.clearActiveItems();return;case Wi:if(!t.isOpen&&t.hasOptions)t.open();else if(t.activeOption){let i=t.getAdjacent(t.activeOption,1);i&&t.setActiveOption(i)}N(e);return;case Ki:if(t.activeOption){let i=t.getAdjacent(t.activeOption,-1);i&&t.setActiveOption(i)}N(e);return;case ji:t.canSelect(t.activeOption)?(t.onOptionSelect(e,t.activeOption),N(e)):(t.settings.create&&t.createItem()||document.activeElement==t.control_input&&t.isOpen)&&N(e);return;case Xi:t.advanceSelection(-1,e);return;case Gi:t.advanceSelection(1,e);return;case on:t.settings.selectOnTab&&(t.canSelect(t.activeOption)&&(t.onOptionSelect(e,t.activeOption),N(e)),t.settings.create&&t.createItem()&&N(e));return;case rn:case qi:t.deleteSelection(e);return}t.isInputHidden&&!_e(qe,e)&&N(e)}onInput(e){if(this.isLocked)return;const t=this.inputValue();if(this.lastValue!==t){if(this.lastValue=t,t==""){this._onInput();return}this.refreshTimeout&&window.clearTimeout(this.refreshTimeout),this.refreshTimeout=Ni(()=>{this.refreshTimeout=null,this._onInput()},this.settings.refreshThrottle)}}_onInput(){const e=this.lastValue;this.settings.shouldLoad.call(this,e)&&this.load(e),this.refreshOptions(),this.trigger("type",e)}onOptionHover(e,t){this.ignoreHover||this.setActiveOption(t,!1)}onFocus(e){var t=this,i=t.isFocused;if(t.isDisabled||t.isReadOnly){t.blur(),N(e);return}t.ignoreFocus||(t.isFocused=!0,t.settings.preload==="focus"&&t.preload(),i||t.trigger("focus"),t.activeItems.length||(t.inputState(),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState())}onBlur(e){if(document.hasFocus()!==!1){var t=this;if(t.isFocused){t.isFocused=!1,t.ignoreFocus=!1;var i=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")};t.settings.create&&t.settings.createOnBlur?t.createItem(null,i):i()}}}onOptionSelect(e,t){var i,r=this;t.parentElement&&t.parentElement.matches("[data-disabled]")||(t.classList.contains("create")?r.createItem(null,()=>{r.settings.closeAfterSelect&&r.close()}):(i=t.dataset.value,typeof i<"u"&&(r.lastQuery=null,r.addItem(i),r.settings.closeAfterSelect&&r.close(),!r.settings.hideSelected&&e.type&&/click/.test(e.type)&&r.setActiveOption(t))))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,t){var i=this;return!i.isLocked&&i.settings.mode==="multi"?(N(e),i.setActiveItem(t,e),!0):!1}canLoad(e){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(e))}load(e){const t=this;if(!t.canLoad(e))return;U(t.wrapper,t.settings.loadingClass),t.loading++;const i=t.loadCallback.bind(t);t.settings.load.call(t,e,i)}loadCallback(e,t){const i=this;i.loading=Math.max(i.loading-1,0),i.lastQuery=null,i.clearActiveOption(),i.setupOptions(e,t),i.refreshOptions(i.isFocused&&!i.isInputHidden),i.loading||fe(i.wrapper,i.settings.loadingClass),i.trigger("load",e,t)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var t=this.control_input,i=t.value!==e;i&&(t.value=e,At(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){var i=t?[]:["change"];Zt(this,i,()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,t){var i=this,r,o,s,a,c,l;if(i.settings.mode!=="single"){if(!e){i.clearActiveItems(),i.isFocused&&i.inputState();return}if(r=t&&t.type.toLowerCase(),r==="click"&&_e("shiftKey",t)&&i.activeItems.length){for(l=i.getLastActive(),s=Array.prototype.indexOf.call(i.control.children,l),a=Array.prototype.indexOf.call(i.control.children,e),s>a&&(c=s,s=a,a=c),o=s;o<=a;o++)e=i.control.children[o],i.activeItems.indexOf(e)===-1&&i.setActiveItemClass(e);N(t)}else r==="click"&&_e(qe,t)||r==="keydown"&&_e("shiftKey",t)?e.classList.contains("active")?i.removeActiveItem(e):i.setActiveItemClass(e):(i.clearActiveItems(),i.setActiveItemClass(e));i.inputState(),i.isFocused||i.focus()}}setActiveItemClass(e){const t=this,i=t.control.querySelector(".last-active");i&&fe(i,"last-active"),U(e,"active last-active"),t.trigger("item_select",e),t.activeItems.indexOf(e)==-1&&t.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),fe(e,"active")}clearActiveItems(){fe(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,t=!0){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,k(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),k(e,{"aria-selected":"true"}),U(e,"active"),t&&this.scrollToOption(e)))}scrollToOption(e,t){if(!e)return;const i=this.dropdown_content,r=i.clientHeight,o=i.scrollTop||0,s=e.offsetHeight,a=e.getBoundingClientRect().top-i.getBoundingClientRect().top+o;a+s>r+o?this.scroll(a-r+s,t):a<o&&this.scroll(a,t)}scroll(e,t){const i=this.dropdown_content;t&&(i.style.scrollBehavior=t),i.scrollTop=e,i.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(fe(this.activeOption,"active"),k(this.activeOption,{"aria-selected":null})),this.activeOption=null,k(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const t=e.controlChildren();t.length&&(e.inputState(),e.close(),e.activeItems=t,Y(t,i=>{e.setActiveItemClass(i)}))}inputState(){var e=this;e.control.contains(e.control_input)&&(k(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&k(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||e.isReadOnly||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return typeof e.sortField=="string"&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var t,i,r=this,o=this.getSearchOptions();if(r.settings.score&&(i=r.settings.score.call(r,e),typeof i!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==r.lastQuery?(r.lastQuery=e,t=r.sifter.search(e,Object.assign(o,{score:i})),r.currentResults=t):t=Object.assign({},r.currentResults),r.settings.hideSelected&&(t.items=t.items.filter(s=>{let a=te(s.id);return!(a&&r.items.indexOf(a)!==-1)})),t}refreshOptions(e=!0){var t,i,r,o,s,a,c,l,u,d;const f={},v=[];var p=this,m=p.inputValue();const C=m===p.lastQuery||m==""&&p.lastQuery==null;var E=p.search(m),g=null,S=p.settings.shouldOpen||!1,x=p.dropdown_content;C&&(g=p.activeOption,g&&(u=g.closest("[data-group]"))),o=E.items.length,typeof p.settings.maxOptions=="number"&&(o=Math.min(o,p.settings.maxOptions)),o>0&&(S=!0);const $=(O,T)=>{let b=f[O];if(b!==void 0){let A=v[b];if(A!==void 0)return[b,A.fragment]}let P=document.createDocumentFragment();return b=v.length,v.push({fragment:P,order:T,optgroup:O}),[b,P]};for(t=0;t<o;t++){let O=E.items[t];if(!O)continue;let T=O.id,b=p.options[T];if(b===void 0)continue;let P=nt(T),A=p.getOption(P,!0);for(p.settings.hideSelected||A.classList.toggle("selected",p.items.includes(P)),s=b[p.settings.optgroupField]||"",a=Array.isArray(s)?s:[s],i=0,r=a&&a.length;i<r;i++){s=a[i];let ie=b.$order,G=p.optgroups[s];G===void 0?s="":ie=G.$order;const[ae,me]=$(s,ie);i>0&&(A=A.cloneNode(!0),k(A,{id:b.$id+"-clone-"+i,"aria-selected":null}),A.classList.add("ts-cloned"),fe(A,"active"),p.activeOption&&p.activeOption.dataset.value==T&&u&&u.dataset.group===s.toString()&&(g=A)),me.appendChild(A),s!=""&&(f[s]=ae)}}p.settings.lockOptgroupOrder&&v.sort((O,T)=>O.order-T.order),c=document.createDocumentFragment(),Y(v,O=>{let T=O.fragment,b=O.optgroup;if(!T||!T.children.length)return;let P=p.optgroups[b];if(P!==void 0){let A=document.createDocumentFragment(),ie=p.render("optgroup_header",P);we(A,ie),we(A,T);let G=p.render("optgroup",{group:P,options:A});we(c,G)}else we(c,T)}),x.innerHTML="",we(x,c),p.settings.highlight&&(Vi(x),E.query.length&&E.tokens.length&&Y(E.tokens,O=>{Ri(x,O.regex)}));var R=O=>{let T=p.render(O,{input:m});return T&&(S=!0,x.insertBefore(T,x.firstChild)),T};if(p.loading?R("loading"):p.settings.shouldLoad.call(p,m)?E.items.length===0&&R("no_results"):R("not_loading"),l=p.canCreate(m),l&&(d=R("option_create")),p.hasOptions=E.items.length>0||l,S){if(E.items.length>0){if(!g&&p.settings.mode==="single"&&p.items[0]!=null&&(g=p.getOption(p.items[0])),!x.contains(g)){let O=0;d&&!p.settings.addPrecedence&&(O=1),g=p.selectable()[O]}}else d&&(g=d);e&&!p.isOpen&&(p.open(),p.scrollToOption(g,"auto")),p.setActiveOption(g)}else p.clearActiveOption(),e&&p.isOpen&&p.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){const i=this;if(Array.isArray(e))return i.addOptions(e,t),!1;const r=te(e[i.settings.valueField]);return r===null||i.options.hasOwnProperty(r)?!1:(e.$order=e.$order||++i.order,e.$id=i.inputId+"-opt-"+e.$order,i.options[r]=e,i.lastQuery=null,t&&(i.userOptions[r]=t,i.trigger("option_add",r,e)),r)}addOptions(e,t=!1){Y(e,i=>{this.addOption(i,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=te(e[this.settings.optgroupValueField]);return t===null?!1:(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){var i;t[this.settings.optgroupValueField]=e,(i=this.registerOptionGroup(t))&&this.trigger("optgroup_add",i,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){const i=this;var r,o;const s=te(e),a=te(t[i.settings.valueField]);if(s===null)return;const c=i.options[s];if(c==null)return;if(typeof a!="string")throw new Error("Value must be set in option data");const l=i.getOption(s),u=i.getItem(s);if(t.$order=t.$order||c.$order,delete i.options[s],i.uncacheValue(a),i.options[a]=t,l){if(i.dropdown_content.contains(l)){const d=i._render("option",t);Lt(l,d),i.activeOption===l&&i.setActiveOption(d)}l.remove()}u&&(o=i.items.indexOf(s),o!==-1&&i.items.splice(o,1,a),r=i._render("item",t),u.classList.contains("active")&&U(r,"active"),Lt(u,r)),i.lastQuery=null}removeOption(e,t){const i=this;e=nt(e),i.uncacheValue(e),delete i.userOptions[e],delete i.options[e],i.lastQuery=null,i.trigger("option_remove",e),i.removeItem(e,t)}clearOptions(e){const t=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const i={};Y(this.options,(r,o)=>{t(r,o)&&(i[o]=r)}),this.options=this.sifter.items=i,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,t){return this.items.indexOf(t)>=0}getOption(e,t=!1){const i=te(e);if(i===null)return null;const r=this.options[i];if(r!=null){if(r.$div)return r.$div;if(t)return this._render("option",r)}return null}getAdjacent(e,t,i="option"){var r=this,o;if(!e)return null;i=="item"?o=r.controlChildren():o=r.dropdown_content.querySelectorAll("[data-selectable]");for(let s=0;s<o.length;s++)if(o[s]==e)return t>0?o[s+1]:o[s-1];return null}getItem(e){if(typeof e=="object")return e;var t=te(e);return t!==null?this.control.querySelector(`[data-value="${en(t)}"]`):null}addItems(e,t){var i=this,r=Array.isArray(e)?e:[e];r=r.filter(s=>i.items.indexOf(s)===-1);const o=r[r.length-1];r.forEach(s=>{i.isPending=s!==o,i.addItem(s,t)})}addItem(e,t){var i=t?[]:["change","dropdown_close"];Zt(this,i,()=>{var r,o;const s=this,a=s.settings.mode,c=te(e);if(!(c&&s.items.indexOf(c)!==-1&&(a==="single"&&s.close(),a==="single"||!s.settings.duplicates))&&!(c===null||!s.options.hasOwnProperty(c))&&(a==="single"&&s.clear(t),!(a==="multi"&&s.isFull()))){if(r=s._render("item",s.options[c]),s.control.contains(r)&&(r=r.cloneNode(!0)),o=s.isFull(),s.items.splice(s.caretPos,0,c),s.insertAtCaret(r),s.isSetup){if(!s.isPending&&s.settings.hideSelected){let l=s.getOption(c),u=s.getAdjacent(l,1);u&&s.setActiveOption(u)}!s.isPending&&!s.settings.closeAfterSelect&&s.refreshOptions(s.isFocused&&a!=="single"),s.settings.closeAfterSelect!=!1&&s.isFull()?s.close():s.isPending||s.positionDropdown(),s.trigger("item_add",c,r),s.isPending||s.updateOriginalInput({silent:t})}(!s.isPending||!o&&s.isFull())&&(s.inputState(),s.refreshState())}})}removeItem(e=null,t){const i=this;if(e=i.getItem(e),!e)return;var r,o;const s=e.dataset.value;r=nn(e),e.remove(),e.classList.contains("active")&&(o=i.activeItems.indexOf(e),i.activeItems.splice(o,1),fe(e,"active")),i.items.splice(r,1),i.lastQuery=null,!i.settings.persist&&i.userOptions.hasOwnProperty(s)&&i.removeOption(s,t),r<i.caretPos&&i.setCaret(i.caretPos-1),i.updateOriginalInput({silent:t}),i.refreshState(),i.positionDropdown(),i.trigger("item_remove",s,e)}createItem(e=null,t=()=>{}){arguments.length===3&&(t=arguments[2]),typeof t!="function"&&(t=()=>{});var i=this,r=i.caretPos,o;if(e=e||i.inputValue(),!i.canCreate(e))return t(),!1;i.lock();var s=!1,a=c=>{if(i.unlock(),!c||typeof c!="object")return t();var l=te(c[i.settings.valueField]);if(typeof l!="string")return t();i.setTextboxValue(),i.addOption(c,!0),i.setCaret(r),i.addItem(l),t(c),s=!0};return typeof i.settings.create=="function"?o=i.settings.create.call(this,e,a):o={[i.settings.labelField]:e,[i.settings.valueField]:e},s||a(o),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const t=e.isFull(),i=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const r=e.wrapper.classList;r.toggle("focus",e.isFocused),r.toggle("disabled",e.isDisabled),r.toggle("readonly",e.isReadOnly),r.toggle("required",e.isRequired),r.toggle("invalid",!e.isValid),r.toggle("locked",i),r.toggle("full",t),r.toggle("input-active",e.isFocused&&!e.isInputHidden),r.toggle("dropdown-active",e.isOpen),r.toggle("has-options",Hi(e.options)),r.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const t=this;var i,r;const o=t.input.querySelector('option[value=""]');if(t.is_select_tag){let c=function(l,u,d){return l||(l=re('<option value="'+Ct(u)+'">'+Ct(d)+"</option>")),l!=o&&t.input.append(l),s.push(l),(l!=o||a>0)&&(l.selected=!0),l};const s=[],a=t.input.querySelectorAll("option:checked").length;t.input.querySelectorAll("option:checked").forEach(l=>{l.selected=!1}),t.items.length==0&&t.settings.mode=="single"?c(o,"",""):t.items.forEach(l=>{if(i=t.options[l],r=i[t.settings.labelField]||"",s.includes(i.$option)){const u=t.input.querySelector(`option[value="${en(l)}"]:not(:checked)`);c(u,l,r)}else i.$option=c(i.$option,l,r)})}else t.input.value=t.getValue();t.isSetup&&(e.silent||t.trigger("change",t.getValue()))}open(){var e=this;e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull()||(e.isOpen=!0,k(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),We(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),We(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var t=this,i=t.isOpen;e&&(t.setTextboxValue(),t.settings.mode==="single"&&t.items.length&&t.inputState()),t.isOpen=!1,k(t.focus_node,{"aria-expanded":"false"}),We(t.dropdown,{display:"none"}),t.settings.hideSelected&&t.clearActiveOption(),t.refreshState(),i&&t.trigger("dropdown_close",t.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var e=this.control,t=e.getBoundingClientRect(),i=e.offsetHeight+t.top+window.scrollY,r=t.left+window.scrollX;We(this.dropdown,{width:t.width+"px",top:i+"px",left:r+"px"})}}clear(e){var t=this;if(t.items.length){var i=t.controlChildren();Y(i,r=>{t.removeItem(r,!0)}),t.inputState(),e||t.updateOriginalInput(),t.trigger("clear")}}insertAtCaret(e){const t=this,i=t.caretPos,r=t.control;r.insertBefore(e,r.children[i]||null),t.setCaret(i+1)}deleteSelection(e){var t,i,r,o,s=this;t=e&&e.keyCode===rn?-1:1,i=$i(s.control_input);const a=[];if(s.activeItems.length)o=tn(s.activeItems,t),r=nn(o),t>0&&r++,Y(s.activeItems,c=>a.push(c));else if((s.isFocused||s.settings.mode==="single")&&s.items.length){const c=s.controlChildren();let l;t<0&&i.start===0&&i.length===0?l=c[s.caretPos-1]:t>0&&i.start===s.inputValue().length&&(l=c[s.caretPos]),l!==void 0&&a.push(l)}if(!s.shouldDelete(a,e))return!1;for(N(e,!0),typeof r<"u"&&s.setCaret(r);a.length;)s.removeItem(a.pop());return s.inputState(),s.positionDropdown(),s.refreshOptions(!1),!0}shouldDelete(e,t){const i=e.map(r=>r.dataset.value);return!(!i.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(i,t)===!1)}advanceSelection(e,t){var i,r,o=this;o.rtl&&(e*=-1),!o.inputValue().length&&(_e(qe,t)||_e("shiftKey",t)?(i=o.getLastActive(e),i?i.classList.contains("active")?r=o.getAdjacent(i,e,"item"):r=i:e>0?r=o.control_input.nextElementSibling:r=o.control_input.previousElementSibling,r&&(r.classList.contains("active")&&o.removeActiveItem(i),o.setActiveItemClass(r))):o.moveCaret(e))}moveCaret(e){}getLastActive(e){let t=this.control.querySelector(".last-active");if(t)return t;var i=this.control.querySelectorAll(".active");if(i)return tn(i,e)}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.setLocked(!0)}unlock(){this.setLocked(!1)}setLocked(e=this.isReadOnly||this.isDisabled){this.isLocked=e,this.refreshState()}disable(){this.setDisabled(!0),this.close()}enable(){this.setDisabled(!1)}setDisabled(e){this.focus_node.tabIndex=e?-1:this.tabIndex,this.isDisabled=e,this.input.disabled=e,this.control_input.disabled=e,this.setLocked()}setReadOnly(e){this.isReadOnly=e,this.input.readOnly=e,this.control_input.readOnly=e,this.setLocked()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,fe(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,t){var i,r;const o=this;if(typeof this.settings.render[e]!="function"||(r=o.settings.render[e].call(this,t,Ct),!r))return null;if(r=re(r),e==="option"||e==="option_create"?t[o.settings.disabledField]?k(r,{"aria-disabled":"true"}):k(r,{"data-selectable":""}):e==="optgroup"&&(i=t.group[o.settings.optgroupValueField],k(r,{"data-group":i}),t.group[o.settings.disabledField]&&k(r,{"data-disabled":""})),e==="option"||e==="item"){const s=nt(t[o.settings.valueField]);k(r,{"data-value":s}),e==="item"?(U(r,o.settings.itemClass),k(r,{"data-ts-item":""})):(U(r,o.settings.optionClass),k(r,{role:"option",id:t.$id}),t.$div=r,o.options[s]=t)}return r}_render(e,t){const i=this.render(e,t);if(i==null)throw"HTMLElement expected";return i}clearCache(){Y(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,t,i){var r=this,o=r[t];r[t]=function(){var s,a;return e==="after"&&(s=o.apply(r,arguments)),a=i.apply(r,arguments),e==="instead"?a:(e==="before"&&(s=o.apply(r,arguments)),s)}}}const Qi=(n,e,t,i)=>{n.addEventListener(e,t,i)};function Ji(){Qi(this.input,"change",()=>{this.sync()})}const Zi=n=>typeof n>"u"||n===null?null:er(n),er=n=>typeof n=="boolean"?n?"1":"0":n+"",cn=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},tr=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(nr(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},nr=n=>typeof n=="string"&&n.indexOf("<")>-1;function ir(n){var e=this,t=e.onOptionSelect;e.settings.hideSelected=!1;const i=Object.assign({className:"tomselect-checkbox",checkedClassNames:void 0,uncheckedClassNames:void 0},n);var r=function(a,c){c?(a.checked=!0,i.uncheckedClassNames&&a.classList.remove(...i.uncheckedClassNames),i.checkedClassNames&&a.classList.add(...i.checkedClassNames)):(a.checked=!1,i.checkedClassNames&&a.classList.remove(...i.checkedClassNames),i.uncheckedClassNames&&a.classList.add(...i.uncheckedClassNames))},o=function(a){setTimeout(()=>{var c=a.querySelector("input."+i.className);c instanceof HTMLInputElement&&r(c,a.classList.contains("selected"))},1)};e.hook("after","setupTemplates",()=>{var s=e.settings.render.option;e.settings.render.option=(a,c)=>{var l=tr(s.call(e,a,c)),u=document.createElement("input");i.className&&u.classList.add(i.className),u.addEventListener("click",function(f){cn(f)}),u.type="checkbox";const d=Zi(a[e.settings.valueField]);return r(u,!!(d&&e.items.indexOf(d)>-1)),l.prepend(u),l}}),e.on("item_remove",s=>{var a=e.getOption(s);a&&(a.classList.remove("selected"),o(a))}),e.on("item_add",s=>{var a=e.getOption(s);a&&o(a)}),e.hook("instead","onOptionSelect",(s,a)=>{if(a.classList.contains("selected")){a.classList.remove("selected"),e.removeItem(a.dataset.value),e.refreshOptions(),cn(s,!0);return}t.call(e,s,a),o(a)})}const rr=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(or(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},or=n=>typeof n=="string"&&n.indexOf("<")>-1;function sr(n){const e=this,t=Object.assign({className:"clear-button",title:"Clear All",html:i=>`<div class="${i.className}" title="${i.title}">&#10799;</div>`},n);e.on("initialize",()=>{var i=rr(t.html(t));i.addEventListener("click",r=>{e.isLocked||(e.clear(),e.settings.mode==="single"&&e.settings.allowEmptyOption&&e.addItem(""),r.preventDefault(),r.stopPropagation())}),e.control.appendChild(i)})}const ar=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},Ce=(n,e,t,i)=>{n.addEventListener(e,t,i)},lr=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},cr=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(dr(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},dr=n=>typeof n=="string"&&n.indexOf("<")>-1,ur=(n,e)=>{lr(e,(t,i)=>{t==null?n.removeAttribute(i):n.setAttribute(i,""+t)})},fr=(n,e)=>{var t;(t=n.parentNode)==null||t.insertBefore(e,n.nextSibling)},pr=(n,e)=>{var t;(t=n.parentNode)==null||t.insertBefore(e,n)},hr=(n,e)=>{do{var t;if(e=(t=e)==null?void 0:t.previousElementSibling,n==e)return!0}while(e&&e.previousElementSibling);return!1};function gr(){var n=this;if(n.settings.mode!=="multi")return;var e=n.lock,t=n.unlock;let i=!0,r;n.hook("after","setupTemplates",()=>{var o=n.settings.render.item;n.settings.render.item=(s,a)=>{const c=cr(o.call(n,s,a));ur(c,{draggable:"true"});const l=m=>{i||ar(m),m.stopPropagation()},u=m=>{r=c,setTimeout(()=>{c.classList.add("ts-dragging")},0)},d=m=>{m.preventDefault(),c.classList.add("ts-drag-over"),v(c,r)},f=()=>{c.classList.remove("ts-drag-over")},v=(m,C)=>{C!==void 0&&(hr(C,c)?fr(m,C):pr(m,C))},p=()=>{var m;document.querySelectorAll(".ts-drag-over").forEach(E=>E.classList.remove("ts-drag-over")),(m=r)==null||m.classList.remove("ts-dragging"),r=void 0;var C=[];n.control.querySelectorAll("[data-value]").forEach(E=>{if(E.dataset.value){let g=E.dataset.value;g&&C.push(g)}}),n.setValue(C)};return Ce(c,"mousedown",l),Ce(c,"dragstart",u),Ce(c,"dragenter",d),Ce(c,"dragover",d),Ce(c,"dragleave",f),Ce(c,"dragend",p),c}}),n.hook("instead","lock",()=>(i=!1,e.call(n))),n.hook("instead","unlock",()=>(i=!0,t.call(n)))}const mr=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},vr=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(br(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},br=n=>typeof n=="string"&&n.indexOf("<")>-1;function yr(n){const e=this,t=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:i=>'<div class="'+i.headerClass+'"><div class="'+i.titleRowClass+'"><span class="'+i.labelClass+'">'+i.title+'</span><a class="'+i.closeClass+'">&times;</a></div></div>'},n);e.on("initialize",()=>{var i=vr(t.html(t)),r=i.querySelector("."+t.closeClass);r&&r.addEventListener("click",o=>{mr(o,!0),e.close()}),e.dropdown.insertBefore(i,e.dropdown.firstChild)})}const _r=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},wr=(n,...e)=>{var t=Er(e);n=Sr(n),n.map(i=>{t.map(r=>{i.classList.remove(r)})})},Er=n=>{var e=[];return _r(n,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},Sr=n=>(Array.isArray(n)||(n=[n]),n),Or=(n,e)=>{if(!n)return-1;e=e||n.nodeName;for(var t=0;n=n.previousElementSibling;)n.matches(e)&&t++;return t};function Cr(){var n=this;n.hook("instead","setCaret",e=>{n.settings.mode==="single"||!n.control.contains(n.control_input)?e=n.items.length:(e=Math.max(0,Math.min(n.items.length,e)),e!=n.caretPos&&!n.isPending&&n.controlChildren().forEach((t,i)=>{i<e?n.control_input.insertAdjacentElement("beforebegin",t):n.control.appendChild(t)})),n.caretPos=e}),n.hook("instead","moveCaret",e=>{if(!n.isFocused)return;const t=n.getLastActive(e);if(t){const i=Or(t);n.setCaret(e>0?i+1:i),n.setActiveItem(),wr(t,"last-active")}else n.setCaret(n.caretPos+e)})}const xr=27,Ar=9,Tr=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},Ir=(n,e,t,i)=>{n.addEventListener(e,t,i)},Dr=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},dn=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(kr(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},kr=n=>typeof n=="string"&&n.indexOf("<")>-1,Fr=(n,...e)=>{var t=Lr(e);n=Pr(n),n.map(i=>{t.map(r=>{i.classList.add(r)})})},Lr=n=>{var e=[];return Dr(n,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},Pr=n=>(Array.isArray(n)||(n=[n]),n);function Nr(){const n=this;n.settings.shouldOpen=!0,n.hook("before","setup",()=>{n.focus_node=n.control,Fr(n.control_input,"dropdown-input");const e=dn('<div class="dropdown-input-wrap">');e.append(n.control_input),n.dropdown.insertBefore(e,n.dropdown.firstChild);const t=dn('<input class="items-placeholder" tabindex="-1" />');t.placeholder=n.settings.placeholder||"",n.control.append(t)}),n.on("initialize",()=>{n.control_input.addEventListener("keydown",t=>{switch(t.keyCode){case xr:n.isOpen&&(Tr(t,!0),n.close()),n.clearActiveItems();return;case Ar:n.focus_node.tabIndex=-1;break}return n.onKeyDown.call(n,t)}),n.on("blur",()=>{n.focus_node.tabIndex=n.isDisabled?-1:n.tabIndex}),n.on("dropdown_open",()=>{n.control_input.focus()});const e=n.onBlur;n.hook("instead","onBlur",t=>{if(!(t&&t.relatedTarget==n.control_input))return e.call(n)}),Ir(n.control_input,"blur",()=>n.onBlur()),n.hook("before","close",()=>{n.isOpen&&n.focus_node.focus({preventScroll:!0})})})}const Ue=(n,e,t,i)=>{n.addEventListener(e,t,i)};function Mr(){var n=this;n.on("initialize",()=>{var e=document.createElement("span"),t=n.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",n.wrapper.appendChild(e);var i=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const o of i)e.style[o]=t.style[o];var r=()=>{e.textContent=t.value,t.style.width=e.clientWidth+"px"};r(),n.on("update item_add item_remove",r),Ue(t,"input",r),Ue(t,"keyup",r),Ue(t,"blur",r),Ue(t,"update",r)})}function $r(){var n=this,e=n.deleteSelection;this.hook("instead","deleteSelection",t=>n.activeItems.length?e.call(n,t):!1)}function Br(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}const un=37,Hr=39,Rr=(n,e,t)=>{for(;n&&n.matches;){if(n.matches(e))return n;n=n.parentNode}},Vr=(n,e)=>{if(!n)return-1;e=e||n.nodeName;for(var t=0;n=n.previousElementSibling;)n.matches(e)&&t++;return t};function Yr(){var n=this,e=n.onKeyDown;n.hook("instead","onKeyDown",t=>{var i,r,o,s;if(!n.isOpen||!(t.keyCode===un||t.keyCode===Hr))return e.call(n,t);n.ignoreHover=!0,s=Rr(n.activeOption,"[data-group]"),i=Vr(n.activeOption,"[data-selectable]"),s&&(t.keyCode===un?s=s.previousSibling:s=s.nextSibling,s&&(o=s.querySelectorAll("[data-selectable]"),r=o[Math.min(o.length-1,i)],r&&n.setActiveOption(r)))})}const jr=n=>(n+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),fn=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},pn=(n,e,t,i)=>{n.addEventListener(e,t,i)},hn=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(zr(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},zr=n=>typeof n=="string"&&n.indexOf("<")>-1;function Xr(n){const e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},n);var t=this;if(e.append){var i='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+jr(e.title)+'">'+e.label+"</a>";t.hook("after","setupTemplates",()=>{var r=t.settings.render.item;t.settings.render.item=(o,s)=>{var a=hn(r.call(t,o,s)),c=hn(i);return a.appendChild(c),pn(c,"mousedown",l=>{fn(l,!0)}),pn(c,"click",l=>{t.isLocked||(fn(l,!0),!t.isLocked&&t.shouldDelete([a],l)&&(t.removeItem(a),t.refreshOptions(!1),t.inputState()))}),a}})}}function Kr(n){const e=this,t=Object.assign({text:i=>i[e.settings.labelField]},n);e.on("item_remove",function(i){if(e.isFocused&&e.control_input.value.trim()===""){var r=e.options[i];r&&e.setTextboxValue(t.text.call(e,r))}})}const Gr=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},Wr=(n,...e)=>{var t=qr(e);n=Ur(n),n.map(i=>{t.map(r=>{i.classList.add(r)})})},qr=n=>{var e=[];return Gr(n,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},Ur=n=>(Array.isArray(n)||(n=[n]),n);function Qr(){const n=this,e=n.canLoad,t=n.clearActiveOption,i=n.loadCallback;var r={},o,s=!1,a,c=[];if(n.settings.shouldLoadMore||(n.settings.shouldLoadMore=()=>{if(o.clientHeight/(o.scrollHeight-o.scrollTop)>.9)return!0;if(n.activeOption){var f=n.selectable(),v=Array.from(f).indexOf(n.activeOption);if(v>=f.length-2)return!0}return!1}),!n.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";n.settings.sortField=[{field:"$order"},{field:"$score"}];const l=d=>typeof n.settings.maxOptions=="number"&&o.children.length>=n.settings.maxOptions?!1:!!(d in r&&r[d]),u=(d,f)=>n.items.indexOf(f)>=0||c.indexOf(f)>=0;n.setNextUrl=(d,f)=>{r[d]=f},n.getUrl=d=>{if(d in r){const f=r[d];return r[d]=!1,f}return n.clearPagination(),n.settings.firstUrl.call(n,d)},n.clearPagination=()=>{r={}},n.hook("instead","clearActiveOption",()=>{if(!s)return t.call(n)}),n.hook("instead","canLoad",d=>d in r?l(d):e.call(n,d)),n.hook("instead","loadCallback",(d,f)=>{if(!s)n.clearOptions(u);else if(a){const v=d[0];v!==void 0&&(a.dataset.value=v[n.settings.valueField])}i.call(n,d,f),s=!1}),n.hook("after","refreshOptions",()=>{const d=n.lastValue;var f;l(d)?(f=n.render("loading_more",{query:d}),f&&(f.setAttribute("data-selectable",""),a=f)):d in r&&!o.querySelector(".no-results")&&(f=n.render("no_more_results",{query:d})),f&&(Wr(f,n.settings.optionClass),o.append(f))}),n.on("initialize",()=>{c=Object.keys(n.options),o=n.dropdown_content,n.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},n.settings.render),o.addEventListener("scroll",()=>{n.settings.shouldLoadMore.call(n)&&l(n.lastValue)&&(s||(s=!0,n.load.call(n,n.lastValue)))})})}K.define("change_listener",Ji);K.define("checkbox_options",ir);K.define("clear_button",sr);K.define("drag_drop",gr);K.define("dropdown_header",yr);K.define("caret_position",Cr);K.define("dropdown_input",Nr);K.define("input_autogrow",Mr);K.define("no_backspace_delete",$r);K.define("no_active_items",Br);K.define("optgroup_columns",Yr);K.define("remove_button",Xr);K.define("restore_on_backspace",Kr);K.define("virtual_scroll",Qr);class Jr{constructor({addButtonId:e,boardId:t,modalId:i}){this.taskIdCounter=1,this.tasks={},this.addTaskBtn=document.getElementById(e),this.taskBoard=document.getElementById(t),this.taskModal=document.getElementById(i),this.taskForm=this.taskModal.querySelector("#task-form"),this.cancelBtn=this.taskModal.querySelector("#cancel-btn"),this.closeBtn=this.taskModal.querySelector("#close-modal"),this.currentEditId=null,this.addTaskBtn.addEventListener("click",()=>this.openModal()),this.cancelBtn.addEventListener("click",()=>this.closeModal()),this.closeBtn.addEventListener("click",()=>this.closeModal()),this.taskForm.addEventListener("submit",o=>{o.preventDefault(),this.saveTask()});const r=this.taskForm.querySelector('select[name="tags"]');r&&(this.tagsSelect=new K(r,{plugins:["remove_button"],delimiter:",",persist:!1,create:!0,placeholder:"Выберите или введите теги...",options:[{value:"urgent",text:"urgent"},{value:"backend",text:"backend"},{value:"frontend",text:"frontend"}]})),this.taskBoard.addEventListener("click",o=>{const s=o.target.closest(".task-card");if(s){const a=s.dataset.id;this.openModal(a)}})}openModal(e=null){if(this.currentEditId=e,e&&this.tasks[e]){const i=this.tasks[e];if(this.taskForm.title.value=i.title,this.taskForm.desc.value=i.desc,this.taskForm.deadline.value=i.deadline,this.taskForm.priority.value=i.priority,this.taskForm.done.checked=i.done,this.tagsSelect){const r=i.tags?i.tags.split(",").map(o=>o.trim()).filter(Boolean):[];this.tagsSelect.clear(),this.tagsSelect.addItems(r)}else this.taskForm.tags.value=i.tags||""}else this.taskForm.reset(),this.tagsSelect&&this.tagsSelect.clear();this.taskModal.classList.remove("hidden");const t=this.taskForm.querySelector('select[name="assignee"]');t&&(t.innerHTML='<option value="">-- Выберите исполнителя --</option>',window.username_data.forEach(i=>{var s,a;const r=document.createElement("option"),o=(s=i.first_name)!=null&&s.trim()?i.first_name:i.username;r.value=i.username,r.textContent=o,e&&((a=this.tasks[e])==null?void 0:a.assignee)===i.username&&(r.selected=!0),t.appendChild(r)}),e||(t.value="")),e&&this.tasks[e]&&(this.taskForm.assignee.value=this.tasks[e].assignee)}closeModal(){this.taskModal.classList.add("hidden")}saveTask(){const e=new FormData(this.taskForm),t={title:e.get("title"),desc:e.get("desc"),deadline:e.get("deadline"),priority:e.get("priority"),assignee:e.get("assignee"),tags:this.tagsSelect?this.tagsSelect.getValue().join(","):"",done:e.get("done")==="on"};if(this.currentEditId)this.tasks[this.currentEditId]=t,this.renderTaskCard(this.currentEditId,t,!0);else{const i=this.taskIdCounter++;this.tasks[i]=t,this.renderTaskCard(i,t)}this.closeModal()}renderTaskCard(e,t,i=!1){let r=this.taskBoard.querySelector(`[data-id="${e}"]`);r?(r.innerHTML="",r.className="task-card",r.dataset.id=e):(r=document.createElement("div"),r.className="task-card",r.dataset.id=e,this.taskBoard.appendChild(r)),({low:"border-l-success dark:border-l-success-dark",medium:"border-l-warning dark:border-l-warning-dark",high:"border-l-error dark:border-l-error-dark"}[t.priority]||"border-l-gray-300").split(" ").forEach(l=>r.classList.add(l));const a=document.createElement("h3");if(a.className="mb-1 truncate font-semibold text-lg",a.textContent=t.title||"Без названия",r.appendChild(a),t.deadline){const l=document.createElement("div");l.className="text-xs text-text dark:text-text-dark mb-1",l.textContent="Срок исполнения: "+t.deadline,r.appendChild(l)}if(t.priority){const l={low:"‍🦼 Низкий",medium:"🚶‍♂️ Средний",high:"🔥🏃‍♂️Высокий"},u={low:"text-green-600",medium:"text-yellow-600",high:"text-red-700"},d=document.createElement("div");d.className="text-xs mb-1";const f=u[t.priority]||"text-gray-500",v=l[t.priority]||t.priority;d.innerHTML=`<span class="${f} font-medium">Приоритет: ${v}</span>`,r.appendChild(d)}if(t.assignee){const l=document.createElement("div");l.className="text-xs text-text dark:text-text-dark mb-1",l.textContent="Исполнитель: "+t.assignee,r.appendChild(l)}if(t.tags){const l=document.createElement("div");l.className="text-xs mb-1 flex flex-wrap gap-1";const u=["text-red-500","text-green-500","text-blue-500","text-yellow-600","text-purple-500"];t.tags.split(",").map(f=>f.trim()).filter(Boolean).forEach((f,v)=>{const p=document.createElement("span");p.textContent=`#${f}`,p.className=u[v%u.length],l.appendChild(p)}),r.appendChild(l)}const c=document.createElement("div");c.className="text-xs font-semibold "+(t.done?"text-green-700":"text-red-600"),c.textContent=t.done?"Выполнено":"В процессе",r.appendChild(c)}}document.addEventListener("DOMContentLoaded",()=>{Rn("a-stickers","a-stickers-mob"),new fi({addButtonId:"add-card",boardId:"note-board",colors:["#FFEB3B","#FFCDD2","#C8E6C9","#BBDEFB"]}).loadInitialNotes(),new Jr({addButtonId:"btn-tasks",boardId:"task-board",modalId:"task-modal"})});
