document.addEventListener("DOMContentLoaded",()=>{const f=document.querySelector("[name=csrfmiddlewaretoken]").value,n=document.querySelector("form"),s=document.getElementById("non-field-errors"),d=document.getElementById("username-label"),i=document.getElementById("username"),l=document.getElementById("password-label"),m=document.getElementById("password"),u=document.getElementById("login-error"),L=document.getElementById("password-error"),p=document.getElementById("login-icon"),_=document.getElementById("password-icon"),v=(t,r,e,o)=>{o.classList.add("hidden"),t.classList.remove("error_label"),t.classList.add("correct_label"),r.classList.remove("error_input"),r.classList.add("correct_input"),e.classList.remove("error_icon"),e.classList.add("correct_icon")},c=(t,r,e,o,a)=>{o.textContent=a,o.classList.remove("hidden"),t.classList.add("error_label"),t.classList.remove("correct_label"),r.classList.add("error_input"),r.classList.remove("correct_input"),e.classList.add("error_icon"),e.classList.remove("correct_icon"),setTimeout(()=>{t.classList.remove("error_label"),t.classList.add("correct_label"),r.classList.remove("error_input"),r.classList.add("correct_input"),e.classList.remove("error_icon"),e.classList.add("correct_icon"),o.textContent="",o.classList.add("hidden")},4e3)};n.addEventListener("submit",async t=>{t.preventDefault(),v(d,i,p,u),v(l,m,_,L),s.classList.add("hidden"),s.classList.remove("flex");const r=new FormData(n);try{const e=await fetch(n.action,{method:"POST",body:r,headers:{"X-CSRFToken":f,"X-Requested-With":"XMLHttpRequest"}}),o=await e.json();if(e.ok)window.location.href=o.redirect_url;else{const a=o.errors;a.username&&c(d,i,p,u,a.username[0].message),a.password&&c(l,m,_,L,a.password[0].message),a.__all__&&(s.querySelector("p").textContent=a.__all__[0].message,s.classList.remove("hidden","animate-popup-reverse"),s.classList.add("flex","animate-popup"),c(d,i,p,u,""),c(l,m,_,L,""),setTimeout(()=>{s.classList.remove("animate-popup"),s.classList.add("animate-popup-reverse"),setTimeout(()=>{s.classList.add("hidden"),s.classList.remove("flex","animate-popup-reverse")},1e3)},4e3))}}catch(e){console.error("Ошибка при отправке формы:",e)}})});
