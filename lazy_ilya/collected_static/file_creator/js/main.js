/* empty css        */function F(t,...o){o.forEach(s=>s.classList.remove("show")),setTimeout(()=>{o.forEach(s=>s.classList.add("hidden")),t.classList.remove("hidden"),setTimeout(()=>{t.classList.add("show")},100)},500)}function H(){const t=document.querySelectorAll(".step"),o={1:document.getElementById("step1-form"),2:document.getElementById("step2-form"),3:document.getElementById("step3-form"),4:document.getElementById("step4-form")};t.forEach(s=>{s.addEventListener("click",()=>{const i=s.dataset.step;t.forEach(e=>e.classList.remove("li-style-active")),s.classList.add("li-style-active");const c=o[i],r=Object.values(o).filter(e=>e!==c);c?F(c,...r):(Object.values(o).forEach(e=>e.classList.remove("show")),setTimeout(()=>{Object.values(o).forEach(e=>e.classList.add("hidden"))},500))})})}function q(){const t=document.getElementById("files"),o=document.getElementById("file-list"),s=document.getElementById("server-info"),i=document.getElementById("btn-div");let c=[];t.addEventListener("change",()=>{c=Array.from(t.files),r()});function r(){o.innerHTML="",c.forEach(l=>{const n=document.createElement("li");n.classList.add("flex","justify-between","items-center","gap-2","mb-1");const f=document.createElement("span");f.textContent=`${l.name} (${(l.size/1024).toFixed(1)} KB)`;const p=h();p.addEventListener("click",()=>{m(l)}),n.appendChild(f),n.appendChild(p),o.appendChild(n)}),e()}function e(){const l=new DataTransfer;c.forEach(n=>l.items.add(n)),t.files=l.files}function h(){const l=document.createElement("button");return l.type="button",l.innerHTML=`<span>Удалить</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
  <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
</svg>
`,l.classList.add("btn-cancel","!w-2/10","flex","justify-center","items-center","gap-1","!py-1"),l}function m(l){s.classList.remove("hidden"),s.classList.add("flex","animate-popup"),s.querySelector("h3").textContent="Подтверждение удаления",s.querySelector("p").textContent=`Вы уверены, что хотите удалить файл "${l.name}"?`,i.innerHTML="";const n=document.createElement("button");n.id="confirm-delete",n.textContent="Да, Нах!",n.classList.add("btn-submit","!w-4/12","!p-1","!font-medium");const f=document.createElement("button");f.id="cancel-delete",f.textContent="Передумал",f.classList.add("btn-cancel","!w-4/12","!p-1","!font-medium"),i.appendChild(n),i.appendChild(f),n.addEventListener("click",()=>{const p=c.indexOf(l);p!==-1&&(c.splice(p,1),r()),a()}),f.addEventListener("click",a)}function a(){s.classList.add("hidden"),s.classList.remove("animate-popup"),s.querySelector("h3").textContent="",s.querySelector("p").textContent="",i.innerHTML=""}function u(){c=[],o.innerHTML="",t.value=""}return{clearFileList:u}}function M(t,o="server-error"){const s=document.getElementById(o);if(!s){console.warn(`Элемент с id "${o}" не найден.`);return}const i=s.querySelector("p");if(!i){console.warn(`В элементе с id "${o}" отсутствует <p> для текста ошибки.`);return}s.classList.remove("hidden","animate-popup-reverse"),s.classList.add("flex","animate-popup"),i.textContent=(typeof t=="string"?t:t.message)||"Произошла ошибка при отправке данных",console.error("Ошибка запроса:",t),setTimeout(()=>{s.classList.remove("animate-popup"),s.classList.add("animate-popup-reverse"),setTimeout(()=>{s.classList.add("hidden"),s.classList.remove("flex","animate-popup-reverse")},1e3)},4e3)}function b(){return`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M15.59 14.37a6 6 0 0 1-5.84 7.38v-4.8m5.84-2.58a14.98 14.98 0 0 0 6.16-12.12A14.98 14.98 0 0 0 9.631 8.41m5.96 5.96a14.926 14.926 0 0 1-5.841 2.58m-.119-8.54a6 6 0 0 0-7.381 5.84h4.8m2.581-5.84a14.927 14.927 0 0 0-2.58 5.84m2.699 2.7c-.103.021-.207.041-.311.06a15.09 15.09 0 0 1-2.448-2.448 14.9 14.9 0 0 1 .06-.312m-2.24 2.39a4.493 4.493 0 0 0-1.757 4.306 4.493 4.493 0 0 0 4.306-1.758M16.5 9a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Z" />
</svg>
`}async function _(t,o,s){const i=document.getElementById("save-content");i.disabled=!0;const c=document.querySelector("[name=csrfmiddlewaretoken]").value,r={files:t,content:o};try{const e=await fetch(s,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRFToken":c},body:JSON.stringify(r)}),h=await e.json();if(!e.ok)throw new Error(h.error||`Ошибка: ${e.status}`);return console.log("Все изменения успешно сохранены:",h),!0}catch(e){return M(e),!1}finally{i.disabled=!1}}async function P(t,o,s){const i=document.getElementById("save-edited-content"),c=document.getElementById("save-content"),r=document.getElementById("btn-div2"),e=document.getElementById("file-content"),h=document.getElementById("file-names-list");o.classList.add("li-style-active");const m=new Map;let a=null,u=null,l=null;if(Array.isArray(t.new_files)&&Array.isArray(t.content)&&(t.new_files.forEach((n,f)=>{m.set(n,t.content[f])}),t.new_files.forEach((n,f)=>{const p=document.createElement("li");p.setAttribute("tabindex","0"),p.classList.add("file-item","group","group-focus:outline-none","group-focus:ring-2","group-focus:ring-[--color-accent]");const v=document.createElement("span");v.textContent=n,v.classList.add("file-name","cursor-pointer","group-hover:text-[--color-accent]"),p.addEventListener("keydown",L=>{L.key==="Tab"&&p.click()}),p.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"}),e.value=m.get(n),e.disabled=!1,e.style.height="auto",e.style.height=e.scrollHeight+"px",i.disabled=!1,c.disabled=!1,document.querySelectorAll(".file-item").forEach(L=>L.classList.remove("file-item-selected")),p.classList.add("file-item-selected"),l=n});const d=document.createElement("button");d.title="Удалить",d.innerHTML=`
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                     stroke="currentColor" class="size-4">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                </svg>
                <span>Удалить</span>`,d.classList.add("opacity-0","btn-cancel","!w-3/10","flex","group-hover:opacity-100","justify-center","items-center","gap-1","!py-1"),d.addEventListener("click",L=>{L.stopPropagation();const y=document.getElementById("server-info2"),g=document.getElementById("btn-div");y.classList.remove("hidden"),y.classList.add("flex","animate-popup"),y.querySelector("h3").textContent=`Удалить файл "${n}"?`,y.querySelector("p").textContent="Это действие нельзя отменить.";const I=document.getElementById("confirm-delete");I&&I.remove();const C=document.getElementById("cancel-delete");C&&C.remove();const w=document.createElement("button");w.id="confirm-delete",w.textContent="Да, Нах!",w.classList.add("btn-submit","!w-4/12","!p-1","!font-medium");const E=document.createElement("button");E.id="cancel-delete",E.textContent="Передумал",E.classList.add("btn-cancel","!w-4/12","!p-1","!font-medium"),r.appendChild(w),r.appendChild(E),w.addEventListener("click",()=>{const x=t.new_files.indexOf(n);if(x!==-1&&(t.new_files.splice(x,1),t.content.splice(x,1)),m.delete(n),p.remove(),l===n){const B=document.querySelectorAll(".file-item");if(B.length>0){const T=B[Math.min(x,B.length-1)],k=T.querySelector(".file-name").textContent;l=k,e.value=m.get(k)||"",e.disabled=!1,e.style.height="auto",e.style.height=e.scrollHeight+"px",document.querySelectorAll(".file-item").forEach(A=>A.classList.remove("file-item-selected")),T.classList.add("file-item-selected")}else l=null,e.value="",e.disabled=!0,e.style.height="auto",e.style.height="2.5rem",c.disabled=!0,i.disabled=!0}y.classList.add("hidden"),g.innerHTML=""}),E.addEventListener("click",()=>{y.classList.add("hidden"),g.innerHTML=""})}),p.appendChild(v),p.appendChild(d),h.appendChild(p),f===0&&(a=n,u=p,l=n)})),await new Promise(n=>setTimeout(n,500)),s.classList.remove("hidden"),await new Promise(n=>setTimeout(n,100)),s.classList.add("show"),a){e.value=m.get(a),e.disabled=!1,e.style.height="auto",e.style.height=e.scrollHeight+"px";const n=document.getElementById("save-edited-content");n.disabled=!1,c.disabled=!1,document.querySelectorAll(".file-item").forEach(f=>f.classList.remove("file-item-selected")),u.classList.add("file-item-selected")}e.addEventListener("input",()=>{if(l){e.style.height="auto",e.style.height=e.scrollHeight+"px";const n=e.value;m.set(l,n);const f=t.new_files.indexOf(l);f!==-1&&(t.content[f]=n),console.log(t)}}),await new Promise(n=>setTimeout(n,3e3))}async function j(t,o,s){const i=document.querySelector('.step[data-step="1"]'),c=document.querySelector('.step[data-step="2"]'),r=document.querySelector('.step[data-step="3"]'),e=document.getElementById("step3-form");i.classList.remove("li-style-active"),i.classList.add("li-style-complete","pointer-events-none"),i.querySelector("span").innerHTML=b(),c.classList.add("li-style-active");const h=document.createElement("h2");h.classList.add("text-xl","text-text","dark:text-text-dark","font-semibold"),h.textContent="Илья читает, что ты написал";const m=document.createElement("p");if(m.classList.add("text-md","text-text","dark:text-text-dark","font-medium"),m.textContent="Посмотри правильно ли Илья прочитал. Получены обработанные файлы, ниже приведены их названия.",Array.isArray(t.new_files)){const a=document.createElement("ul");a.className="list-disc pl-5 mt-2 text-md text-text dark:text-text-dark font-medium",t.new_files.forEach(u=>{const l=document.createElement("li");l.textContent=u,a.appendChild(l)}),o.appendChild(h),o.appendChild(m),o.appendChild(a)}await new Promise(a=>setTimeout(a,500)),o.classList.remove("hidden"),await new Promise(a=>setTimeout(a,100)),o.classList.add("show"),s.classList.remove("hidden"),await new Promise(a=>setTimeout(a,5e3)),s.classList.add("hidden"),o.classList.remove("show"),await new Promise(a=>setTimeout(a,1e3)),o.classList.add("hidden"),c.classList.remove("li-style-active"),c.classList.add("li-style-complete","pointer-events-none"),c.querySelector("span").innerHTML=b(),await P(t,r,e)}async function S(t,o,s,i,c,r,e){try{if(c.classList.remove("hidden"),await _(t.new_files,t.content,"/")===!0){c.classList.add("hidden"),window.scrollTo({top:0,behavior:"smooth"}),o.classList.remove("show"),await new Promise(u=>setTimeout(u,500)),o.classList.add("hidden"),s.classList.remove("li-style-active"),s.classList.add("li-style-complete","pointer-events-none"),s.querySelector("span").innerHTML=b(),await new Promise(u=>setTimeout(u,500)),i.classList.add("li-style-active");const m=document.createElement("h2");m.classList.add("text-xl","text-text","dark:text-text-dark","font-semibold"),m.textContent="Илья поработал и хочет спать!";const a=document.createElement("p");a.classList.add("text-md","text-text","dark:text-text-dark","font-medium"),a.textContent="Теперь можно посмотреть, папку с архивом за сегодняшнее число, туда положил все файлы!",r.appendChild(m),r.appendChild(a),r.classList.remove("hidden"),await new Promise(u=>setTimeout(u,100)),r.classList.add("show"),e.classList.remove("hidden"),await new Promise(u=>setTimeout(u,5e3)),e.classList.add("hidden"),r.classList.remove("show"),await new Promise(u=>setTimeout(u,500)),r.classList.add("hidden"),i.classList.remove("li-style-active"),i.classList.add("li-style-complete","pointer-events-none"),i.querySelector("span").innerHTML=b(),await new Promise(u=>setTimeout(u,1e3)),location.reload()}else c.classList.add("hidden"),console.error("Ошибка при сохранении изменений")}catch(h){c.classList.add("hidden"),e.classList.add("hidden"),console.error("Ошибка во время обработки:",h)}}async function N(t,o,s){const i=document.getElementById("upload-spinner"),c=document.getElementById("upload-spinner2"),r=document.getElementById("upload-spinner3"),e=document.getElementById("upload-spinner4"),h=document.getElementById("step2-form"),m=document.getElementById("step3-form"),a=document.getElementById("step4-form"),u=document.getElementById("save-edited-content"),l=document.getElementById("save-content"),n=document.querySelector('.step[data-step="3"]'),f=document.querySelector('.step[data-step="4"]');try{const p=new FormData(t);i.classList.remove("hidden");const v=await fetch(t.action,{method:"POST",body:p}),d=await v.json();if(!v.ok)throw new Error(d.error||`Ошибка: ${v.status}`);console.log("Ответ от сервера:",d),t.reset(),s(),o.classList.remove("show"),setTimeout(()=>o.classList.add("hidden"),500),await j(d,h,c),l.addEventListener("click",()=>{S(d,m,n,f,r,a,e)}),u.addEventListener("click",()=>{S(d,m,n,f,r,a,e)})}catch(p){M(p)}finally{i.classList.add("hidden")}}const{clearFileList:O}=q();function $(){const t=document.getElementById("step1-form"),o=document.getElementById("file-upload-form"),s=document.getElementById("files-label"),i=document.getElementById("files"),c=document.getElementById("start-number-label"),r=document.getElementById("start-number"),e=document.getElementById("device-type-label"),h=document.getElementById("device-type"),m=document.getElementById("files-error"),a=document.getElementById("start-number-error"),u=document.getElementById("device-type-error");document.getElementById("upload-spinner");const l=()=>{[m,a,u].forEach(d=>d.classList.add("hidden"))},n=(d,L,y,g="")=>{g&&(y.textContent=g),y.classList.remove("hidden"),d.classList.remove("correct_input"),d.classList.add("error_input"),L.classList.remove("correct_label"),L.classList.add("error_label"),setTimeout(()=>{y.classList.add("hidden"),d.classList.add("correct_input"),d.classList.remove("error_input"),L.classList.add("correct_label"),L.classList.remove("error_label")},3e3)},f=()=>{const d=[".doc",".docx",".rtf"];if(i.files.length===0)return n(i,s,m,"Загрузите хотя бы один файл."),!1;for(let L=0;L<i.files.length;L++){const y=i.files[L],g=y.name.slice((y.name.lastIndexOf(".")-1>>>0)+2).toLowerCase();if(!d.includes("."+g))return n(i,s,m,"Допустимые форматы: .doc, .docx, .rtf"),!1}return!0},p=()=>{const d=r.value.trim(),L=Number(d);return d===""||isNaN(L)||L<=0?(n(r,c,a,"Введите число больше нуля."),!1):!0},v=()=>h.value===""?(n(h,e,u,"Выберите тип устройства."),!1):!0;o.addEventListener("submit",d=>{d.preventDefault(),l(),f()&p()&v()&&N(o,t,O)})}document.addEventListener("DOMContentLoaded",()=>{$(),H(),q();const t=document.getElementById("a-main");t.classList.toggle("bg-accent"),t.classList.toggle("dark:bg-accent-dark")});
