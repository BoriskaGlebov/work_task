/* empty css        */import{s as q,g as x}from"../../utils.js";function F(s,...n){n.forEach(o=>o.classList.remove("show")),setTimeout(()=>{n.forEach(o=>o.classList.add("hidden")),s.classList.remove("hidden"),setTimeout(()=>{s.classList.add("show")},100)},500)}function H(){const s=document.querySelectorAll(".step"),n={1:document.getElementById("step1-form"),2:document.getElementById("step2-form"),3:document.getElementById("step3-form"),4:document.getElementById("step4-form")};s.forEach(o=>{o.addEventListener("click",()=>{const i=o.dataset.step;s.forEach(e=>e.classList.remove("li-style-active")),o.classList.add("li-style-active");const l=n[i],r=Object.values(n).filter(e=>e!==l);l?F(l,...r):(Object.values(n).forEach(e=>e.classList.remove("show")),setTimeout(()=>{Object.values(n).forEach(e=>e.classList.add("hidden"))},500))})})}function M(){const s=document.getElementById("files"),n=document.getElementById("file-list"),o=document.getElementById("server-info"),i=document.getElementById("btn-div");let l=[];s.addEventListener("change",()=>{l=Array.from(s.files),r()});function r(){n.innerHTML="",l.forEach(c=>{const t=document.createElement("li");t.classList.add("flex","justify-between","items-center","gap-2","mb-1");const h=document.createElement("span");h.textContent=`${c.name} (${(c.size/1024).toFixed(1)} KB)`;const m=v();m.addEventListener("click",()=>{u(c)}),t.appendChild(h),t.appendChild(m),n.appendChild(t)}),e()}function e(){const c=new DataTransfer;l.forEach(t=>c.items.add(t)),s.files=c.files}function v(){const c=document.createElement("button");return c.type="button",c.innerHTML=`Удалить<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="shrink-0 inline size-3 md:size-5 ms-1">
  <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
</svg>
`,c.classList.add("btn-delete"),c}function u(c){o.classList.remove("hidden"),o.classList.add("flex","animate-popup"),o.querySelector("h3").textContent="Подтверждение удаления",o.querySelector("p").textContent=`Вы уверены, что хотите удалить файл "${c.name}"?`,i.innerHTML="";const t=document.createElement("button");t.id="confirm-delete",t.textContent="Да, Нах!",t.classList.add("btn-submit","!p-1","!font-medium");const h=document.createElement("button");h.id="cancel-delete",h.textContent="Передумал",h.classList.add("btn-cancel","!p-1","!font-medium"),i.appendChild(t),i.appendChild(h),t.addEventListener("click",()=>{const m=l.indexOf(c);m!==-1&&(l.splice(m,1),r()),a()}),h.addEventListener("click",a)}function a(){o.classList.remove("animate-popup"),o.classList.add("animate-popup-reverse"),setTimeout(()=>{o.classList.add("hidden"),o.classList.remove("flex","animate-popup-reverse"),o.querySelector("h3").textContent="",o.querySelector("p").textContent="",i.innerHTML=""},500)}function p(){l=[],n.innerHTML="",s.value=""}return{clearFileList:p}}async function _(s,n,o){const i=document.getElementById("save-content");i.disabled=!0;const l=document.querySelector("[name=csrfmiddlewaretoken]").value,r={files:s,content:n};try{const e=await fetch(o,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRFToken":l},body:JSON.stringify(r)}),v=await e.json();if(!e.ok)throw new Error(v.error||`Ошибка: ${e.status}`);return console.log("Все изменения успешно сохранены:",v),!0}catch(e){return q(e,"server-error2"),!1}finally{i.disabled=!1}}async function P(s,n,o){const i=document.getElementById("save-edited-content"),l=document.getElementById("save-content"),r=document.getElementById("btn-div2"),e=document.getElementById("file-content"),v=document.getElementById("file-names-list");n.classList.add("li-style-active");const u=new Map;let a=null,p=null,c=null;if(Array.isArray(s.new_files)&&Array.isArray(s.content)&&(s.new_files.forEach((t,h)=>{u.set(t,s.content[h])}),s.new_files.forEach((t,h)=>{const m=document.createElement("li");m.setAttribute("tabindex","0"),m.classList.add("focus:outline-none","focus:ring-2","focus:ring-[--color-accent]"),m.classList.add("file-item","group","group-focus:outline-none","group-focus:ring-2","group-focus:ring-[--color-accent]");const y=document.createElement("span");y.textContent=t,y.classList.add("file-name","cursor-pointer","group-hover:text-[--color-accent]"),m.addEventListener("keydown",L=>{L.key==="Tab"&&m.click()}),m.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"}),e.value=u.get(t),e.disabled=!1,e.style.height="auto",e.style.height=e.scrollHeight+"px",i.disabled=!1,l.disabled=!1,document.querySelectorAll(".file-item").forEach(L=>L.classList.remove("file-item-selected")),m.classList.add("file-item-selected"),c=t});const d=document.createElement("button");d.title="Удалить",d.innerHTML=`
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                     stroke="currentColor" class="shrink-0 inline size-4 md:size-5 me-1">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                </svg>
                Удалить`,d.classList.add("opacity-0","btn-delete","!w-4/10","flex","group-hover:opacity-100","justify-center","items-center","!py-1"),d.addEventListener("click",L=>{L.stopPropagation(),window.scrollTo({top:0,behavior:"smooth"});const f=document.getElementById("server-info2"),g=document.getElementById("btn-div");f.classList.remove("hidden"),f.classList.add("flex","animate-popup"),f.querySelector("h3").textContent=`Удалить файл "${t}"?`,f.querySelector("p").textContent="Это действие нельзя отменить.";const I=document.getElementById("confirm-delete");I&&I.remove();const C=document.getElementById("cancel-delete");C&&C.remove();const E=document.createElement("button");E.id="confirm-delete",E.textContent="Да, Нах!",E.classList.add("btn-submit","!p-1","!font-medium");const w=document.createElement("button");w.id="cancel-delete",w.textContent="Передумал",w.classList.add("btn-cancel","!p-1","!font-medium"),r.appendChild(E),r.appendChild(w),E.addEventListener("click",()=>{const b=s.new_files.indexOf(t);if(b!==-1&&(s.new_files.splice(b,1),s.content.splice(b,1)),u.delete(t),m.remove(),c===t){const B=document.querySelectorAll(".file-item");if(B.length>0){const T=B[Math.min(b,B.length-1)],k=T.querySelector(".file-name").textContent;c=k,e.value=u.get(k)||"",e.disabled=!1,e.style.height="auto",e.style.height=e.scrollHeight+"px",document.querySelectorAll(".file-item").forEach(A=>A.classList.remove("file-item-selected")),T.classList.add("file-item-selected")}else c=null,e.value="",e.disabled=!0,e.style.height="auto",e.style.height="2.5rem",l.disabled=!0,i.disabled=!0}f.classList.remove("animate-popup"),f.classList.add("animate-popup-reverse"),setTimeout(()=>{f.classList.add("hidden"),f.classList.remove("flex","animate-popup-reverse"),f.querySelector("h3").textContent="",f.querySelector("p").textContent="",g.innerHTML=""},500)}),w.addEventListener("click",()=>{f.classList.remove("animate-popup"),f.classList.add("animate-popup-reverse"),setTimeout(()=>{f.classList.add("hidden"),f.classList.remove("flex","animate-popup-reverse"),f.querySelector("h3").textContent="",f.querySelector("p").textContent="",g.innerHTML=""},500)})}),m.appendChild(y),m.appendChild(d),v.appendChild(m),h===0&&(a=t,p=m,c=t)})),await new Promise(t=>setTimeout(t,500)),o.classList.remove("hidden"),await new Promise(t=>setTimeout(t,100)),o.classList.add("show"),a){e.value=u.get(a),e.disabled=!1,e.style.height="auto",e.style.height=e.scrollHeight+"px";const t=document.getElementById("save-edited-content");t.disabled=!1,l.disabled=!1,document.querySelectorAll(".file-item").forEach(h=>h.classList.remove("file-item-selected")),p.classList.add("file-item-selected")}e.addEventListener("input",()=>{if(c){e.style.height="auto",e.style.height=e.scrollHeight+"px";const t=e.value;u.set(c,t);const h=s.new_files.indexOf(c);h!==-1&&(s.content[h]=t),console.log(s)}}),await new Promise(t=>setTimeout(t,3e3))}async function N(s,n,o){const i=document.querySelector('.step[data-step="1"]'),l=document.querySelector('.step[data-step="2"]'),r=document.querySelector('.step[data-step="3"]'),e=document.getElementById("step3-form");i.classList.remove("li-style-active"),i.classList.add("li-style-complete","pointer-events-none"),i.querySelector("span").innerHTML=x(),l.classList.add("li-style-active");const v=document.createElement("h2");v.textContent="Илья читает, что ты написал";const u=document.createElement("p");if(u.classList.add("text-text","dark:text-text-dark"),u.textContent="Посмотри правильно ли Илья прочитал. Получены обработанные файлы, ниже приведены их названия.",Array.isArray(s.new_files)){const a=document.createElement("ul");a.className="list-disc pl-5 mt-2 text-sm md:text-base text-text dark:text-text-dark font-medium",s.new_files.forEach(p=>{const c=document.createElement("li");c.textContent=p,a.appendChild(c)}),n.appendChild(v),n.appendChild(u),n.appendChild(a)}await new Promise(a=>setTimeout(a,500)),n.classList.remove("hidden"),await new Promise(a=>setTimeout(a,100)),n.classList.add("show"),o.classList.remove("hidden"),await new Promise(a=>setTimeout(a,5e3)),o.classList.add("hidden"),n.classList.remove("show"),await new Promise(a=>setTimeout(a,1e3)),n.classList.add("hidden"),l.classList.remove("li-style-active"),l.classList.add("li-style-complete","pointer-events-none"),l.querySelector("span").innerHTML=x(),await P(s,r,e)}async function S(s,n,o,i,l,r,e){try{if(l.classList.remove("hidden"),await _(s.new_files,s.content,"/")===!0){l.classList.add("hidden"),window.scrollTo({top:0,behavior:"smooth"}),n.classList.remove("show"),await new Promise(p=>setTimeout(p,500)),n.classList.add("hidden"),o.classList.remove("li-style-active"),o.classList.add("li-style-complete","pointer-events-none"),o.querySelector("span").innerHTML=x(),await new Promise(p=>setTimeout(p,500)),i.classList.add("li-style-active");const u=document.createElement("h2");u.classList.add("text-text","dark:text-text-dark"),u.textContent="Илья поработал и хочет спать!";const a=document.createElement("p");a.classList.add("dark:text-text-dark","font-medium"),a.textContent="Теперь можно посмотреть, папку с архивом за сегодняшнее число, туда положил все файлы!",r.appendChild(u),r.appendChild(a),r.classList.remove("hidden"),await new Promise(p=>setTimeout(p,100)),r.classList.add("show"),e.classList.remove("hidden"),await new Promise(p=>setTimeout(p,5e3)),e.classList.add("hidden"),r.classList.remove("show"),await new Promise(p=>setTimeout(p,500)),r.classList.add("hidden"),i.classList.remove("li-style-active"),i.classList.add("li-style-complete","pointer-events-none"),i.querySelector("span").innerHTML=x(),await new Promise(p=>setTimeout(p,1e3)),location.reload()}else l.classList.add("hidden"),console.error("Ошибка при сохранении изменений")}catch(v){l.classList.add("hidden"),e.classList.add("hidden"),console.error("Ошибка во время обработки:",v)}}async function j(s,n,o){const i=document.getElementById("upload-spinner"),l=document.getElementById("upload-spinner2"),r=document.getElementById("upload-spinner3"),e=document.getElementById("upload-spinner4"),v=document.getElementById("step2-form"),u=document.getElementById("step3-form"),a=document.getElementById("step4-form"),p=document.getElementById("save-edited-content"),c=document.getElementById("save-content"),t=document.querySelector('.step[data-step="3"]'),h=document.querySelector('.step[data-step="4"]');try{const m=new FormData(s);i.classList.remove("hidden");const y=await fetch(s.action,{method:"POST",body:m}),d=await y.json();if(!y.ok)throw new Error(d.error||`Ошибка: ${y.status}`);console.log("Ответ от сервера:",d),s.reset(),o(),n.classList.remove("show"),setTimeout(()=>n.classList.add("hidden"),500),await N(d,v,l),c.addEventListener("click",()=>{S(d,u,t,h,r,a,e)}),p.addEventListener("click",()=>{S(d,u,t,h,r,a,e)})}catch(m){q(m)}finally{i.classList.add("hidden")}}const{clearFileList:O}=M();function $(){const s=document.getElementById("step1-form"),n=document.getElementById("file-upload-form"),o=document.getElementById("files-label"),i=document.getElementById("files"),l=document.getElementById("start-number-label"),r=document.getElementById("start-number"),e=document.getElementById("device-type-label"),v=document.getElementById("device-type"),u=document.getElementById("files-error"),a=document.getElementById("start-number-error"),p=document.getElementById("device-type-error");document.getElementById("upload-spinner");const c=()=>{[u,a,p].forEach(d=>d.classList.add("hidden"))},t=(d,L,f,g="")=>{g&&(f.textContent=g),f.classList.remove("hidden"),d.classList.remove("correct_input"),d.classList.add("error_input"),L.classList.remove("correct_label"),L.classList.add("error_label"),setTimeout(()=>{f.classList.add("hidden"),d.classList.add("correct_input"),d.classList.remove("error_input"),L.classList.add("correct_label"),L.classList.remove("error_label")},3e3)},h=()=>{const d=[".doc",".docx",".rtf"];if(i.files.length===0)return t(i,o,u,"Загрузите хотя бы один файл."),!1;for(let L=0;L<i.files.length;L++){const f=i.files[L],g=f.name.slice((f.name.lastIndexOf(".")-1>>>0)+2).toLowerCase();if(!d.includes("."+g))return t(i,o,u,"Допустимые форматы: .doc, .docx, .rtf"),!1}return!0},m=()=>{const d=r.value.trim(),L=Number(d);return d===""||isNaN(L)||L<=0?(t(r,l,a,"Введите число больше нуля."),!1):!0},y=()=>v.value===""?(t(v,e,p,"Выберите тип устройства."),!1):!0;n.addEventListener("submit",d=>{d.preventDefault(),c(),h()&m()&y()&&j(n,s,O)})}document.addEventListener("DOMContentLoaded",()=>{$(),H(),M();const s=document.getElementById("a-main");s.classList.toggle("bg-accent"),s.classList.toggle("dark:bg-accent-dark");const n=document.getElementById("a-main-mob");n.classList.toggle("bg-accent"),n.classList.toggle("dark:bg-accent-dark")});
