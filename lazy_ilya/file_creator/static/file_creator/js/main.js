/* empty css        */function F(t,...o){o.forEach(s=>s.classList.remove("show")),setTimeout(()=>{o.forEach(s=>s.classList.add("hidden")),t.classList.remove("hidden"),setTimeout(()=>{t.classList.add("show")},100)},500)}function H(){const t=document.querySelectorAll(".step"),o={1:document.getElementById("step1-form"),2:document.getElementById("step2-form"),3:document.getElementById("step3-form"),4:document.getElementById("step4-form")};t.forEach(s=>{s.addEventListener("click",()=>{const i=s.dataset.step;t.forEach(e=>e.classList.remove("li-style-active")),s.classList.add("li-style-active");const l=o[i],r=Object.values(o).filter(e=>e!==l);l?F(l,...r):(Object.values(o).forEach(e=>e.classList.remove("show")),setTimeout(()=>{Object.values(o).forEach(e=>e.classList.add("hidden"))},500))})})}function q(){const t=document.getElementById("files"),o=document.getElementById("file-list"),s=document.getElementById("server-info"),i=document.getElementById("btn-div");let l=[];t.addEventListener("change",()=>{l=Array.from(t.files),r()});function r(){o.innerHTML="",l.forEach(a=>{const n=document.createElement("li");n.classList.add("flex","justify-between","items-center","gap-2","mb-1");const h=document.createElement("span");h.textContent=`${a.name} (${(a.size/1024).toFixed(1)} KB)`;const m=L();m.addEventListener("click",()=>{u(a)}),n.appendChild(h),n.appendChild(m),o.appendChild(n)}),e()}function e(){const a=new DataTransfer;l.forEach(n=>a.items.add(n)),t.files=a.files}function L(){const a=document.createElement("button");return a.type="button",a.innerHTML=`Удалить<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="shrink-0 inline size-3 md:size-5 ms-1">
  <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
</svg>
`,a.classList.add("btn-delete"),a}function u(a){s.classList.remove("hidden"),s.classList.add("flex","animate-popup"),s.querySelector("h3").textContent="Подтверждение удаления",s.querySelector("p").textContent=`Вы уверены, что хотите удалить файл "${a.name}"?`,i.innerHTML="";const n=document.createElement("button");n.id="confirm-delete",n.textContent="Да, Нах!",n.classList.add("btn-submit","!p-1","!font-medium");const h=document.createElement("button");h.id="cancel-delete",h.textContent="Передумал",h.classList.add("btn-cancel","!p-1","!font-medium"),i.appendChild(n),i.appendChild(h),n.addEventListener("click",()=>{const m=l.indexOf(a);m!==-1&&(l.splice(m,1),r()),c()}),h.addEventListener("click",c)}function c(){s.classList.remove("animate-popup"),s.classList.add("animate-popup-reverse"),setTimeout(()=>{s.classList.add("hidden"),s.classList.remove("flex","animate-popup-reverse"),s.querySelector("h3").textContent="",s.querySelector("p").textContent="",i.innerHTML=""},500)}function p(){l=[],o.innerHTML="",t.value=""}return{clearFileList:p}}function M(t,o="server-error"){const s=document.getElementById(o);if(!s){console.warn(`Элемент с id "${o}" не найден.`);return}const i=s.querySelector("p");if(!i){console.warn(`В элементе с id "${o}" отсутствует <p> для текста ошибки.`);return}s.classList.remove("hidden","animate-popup-reverse"),s.classList.add("flex","animate-popup"),i.textContent=(typeof t=="string"?t:t.message)||"Произошла ошибка при отправке данных",s.scrollIntoView({behavior:"smooth",block:"start"}),console.error("Ошибка запроса:",t),setTimeout(()=>{s.classList.remove("animate-popup"),s.classList.add("animate-popup-reverse"),setTimeout(()=>{s.classList.add("hidden"),s.classList.remove("flex","animate-popup-reverse")},1e3)},4e3)}function b(){return`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M15.59 14.37a6 6 0 0 1-5.84 7.38v-4.8m5.84-2.58a14.98 14.98 0 0 0 6.16-12.12A14.98 14.98 0 0 0 9.631 8.41m5.96 5.96a14.926 14.926 0 0 1-5.841 2.58m-.119-8.54a6 6 0 0 0-7.381 5.84h4.8m2.581-5.84a14.927 14.927 0 0 0-2.58 5.84m2.699 2.7c-.103.021-.207.041-.311.06a15.09 15.09 0 0 1-2.448-2.448 14.9 14.9 0 0 1 .06-.312m-2.24 2.39a4.493 4.493 0 0 0-1.757 4.306 4.493 4.493 0 0 0 4.306-1.758M16.5 9a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Z" />
</svg>
`}async function _(t,o,s){const i=document.getElementById("save-content");i.disabled=!0;const l=document.querySelector("[name=csrfmiddlewaretoken]").value,r={files:t,content:o};try{const e=await fetch(s,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRFToken":l},body:JSON.stringify(r)}),L=await e.json();if(!e.ok)throw new Error(L.error||`Ошибка: ${e.status}`);return console.log("Все изменения успешно сохранены:",L),!0}catch(e){return M(e,"server-error2"),!1}finally{i.disabled=!1}}async function P(t,o,s){const i=document.getElementById("save-edited-content"),l=document.getElementById("save-content"),r=document.getElementById("btn-div2"),e=document.getElementById("file-content"),L=document.getElementById("file-names-list");o.classList.add("li-style-active");const u=new Map;let c=null,p=null,a=null;if(Array.isArray(t.new_files)&&Array.isArray(t.content)&&(t.new_files.forEach((n,h)=>{u.set(n,t.content[h])}),t.new_files.forEach((n,h)=>{const m=document.createElement("li");m.setAttribute("tabindex","0"),m.classList.add("focus:outline-none","focus:ring-2","focus:ring-[--color-accent]"),m.classList.add("file-item","group","group-focus:outline-none","group-focus:ring-2","group-focus:ring-[--color-accent]");const y=document.createElement("span");y.textContent=n,y.classList.add("file-name","cursor-pointer","group-hover:text-[--color-accent]"),m.addEventListener("keydown",v=>{v.key==="Tab"&&m.click()}),m.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"}),e.value=u.get(n),e.disabled=!1,e.style.height="auto",e.style.height=e.scrollHeight+"px",i.disabled=!1,l.disabled=!1,document.querySelectorAll(".file-item").forEach(v=>v.classList.remove("file-item-selected")),m.classList.add("file-item-selected"),a=n});const d=document.createElement("button");d.title="Удалить",d.innerHTML=`
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                     stroke="currentColor" class="shrink-0 inline size-4 md:size-5 me-1">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                </svg>
                Удалить`,d.classList.add("opacity-0","btn-delete","!w-4/10","flex","group-hover:opacity-100","justify-center","items-center","!py-1"),d.addEventListener("click",v=>{v.stopPropagation(),window.scrollTo({top:0,behavior:"smooth"});const f=document.getElementById("server-info2"),g=document.getElementById("btn-div");f.classList.remove("hidden"),f.classList.add("flex","animate-popup"),f.querySelector("h3").textContent=`Удалить файл "${n}"?`,f.querySelector("p").textContent="Это действие нельзя отменить.";const C=document.getElementById("confirm-delete");C&&C.remove();const I=document.getElementById("cancel-delete");I&&I.remove();const w=document.createElement("button");w.id="confirm-delete",w.textContent="Да, Нах!",w.classList.add("btn-submit","!p-1","!font-medium");const E=document.createElement("button");E.id="cancel-delete",E.textContent="Передумал",E.classList.add("btn-cancel","!p-1","!font-medium"),r.appendChild(w),r.appendChild(E),w.addEventListener("click",()=>{const x=t.new_files.indexOf(n);if(x!==-1&&(t.new_files.splice(x,1),t.content.splice(x,1)),u.delete(n),m.remove(),a===n){const B=document.querySelectorAll(".file-item");if(B.length>0){const T=B[Math.min(x,B.length-1)],k=T.querySelector(".file-name").textContent;a=k,e.value=u.get(k)||"",e.disabled=!1,e.style.height="auto",e.style.height=e.scrollHeight+"px",document.querySelectorAll(".file-item").forEach(A=>A.classList.remove("file-item-selected")),T.classList.add("file-item-selected")}else a=null,e.value="",e.disabled=!0,e.style.height="auto",e.style.height="2.5rem",l.disabled=!0,i.disabled=!0}f.classList.remove("animate-popup"),f.classList.add("animate-popup-reverse"),setTimeout(()=>{f.classList.add("hidden"),f.classList.remove("flex","animate-popup-reverse"),f.querySelector("h3").textContent="",f.querySelector("p").textContent="",g.innerHTML=""},500)}),E.addEventListener("click",()=>{f.classList.remove("animate-popup"),f.classList.add("animate-popup-reverse"),setTimeout(()=>{f.classList.add("hidden"),f.classList.remove("flex","animate-popup-reverse"),f.querySelector("h3").textContent="",f.querySelector("p").textContent="",g.innerHTML=""},500)})}),m.appendChild(y),m.appendChild(d),L.appendChild(m),h===0&&(c=n,p=m,a=n)})),await new Promise(n=>setTimeout(n,500)),s.classList.remove("hidden"),await new Promise(n=>setTimeout(n,100)),s.classList.add("show"),c){e.value=u.get(c),e.disabled=!1,e.style.height="auto",e.style.height=e.scrollHeight+"px";const n=document.getElementById("save-edited-content");n.disabled=!1,l.disabled=!1,document.querySelectorAll(".file-item").forEach(h=>h.classList.remove("file-item-selected")),p.classList.add("file-item-selected")}e.addEventListener("input",()=>{if(a){e.style.height="auto",e.style.height=e.scrollHeight+"px";const n=e.value;u.set(a,n);const h=t.new_files.indexOf(a);h!==-1&&(t.content[h]=n),console.log(t)}}),await new Promise(n=>setTimeout(n,3e3))}async function N(t,o,s){const i=document.querySelector('.step[data-step="1"]'),l=document.querySelector('.step[data-step="2"]'),r=document.querySelector('.step[data-step="3"]'),e=document.getElementById("step3-form");i.classList.remove("li-style-active"),i.classList.add("li-style-complete","pointer-events-none"),i.querySelector("span").innerHTML=b(),l.classList.add("li-style-active");const L=document.createElement("h2");L.textContent="Илья читает, что ты написал";const u=document.createElement("p");if(u.classList.add("text-text","dark:text-text-dark"),u.textContent="Посмотри правильно ли Илья прочитал. Получены обработанные файлы, ниже приведены их названия.",Array.isArray(t.new_files)){const c=document.createElement("ul");c.className="list-disc pl-5 mt-2 text-sm md:text-base text-text dark:text-text-dark font-medium",t.new_files.forEach(p=>{const a=document.createElement("li");a.textContent=p,c.appendChild(a)}),o.appendChild(L),o.appendChild(u),o.appendChild(c)}await new Promise(c=>setTimeout(c,500)),o.classList.remove("hidden"),await new Promise(c=>setTimeout(c,100)),o.classList.add("show"),s.classList.remove("hidden"),await new Promise(c=>setTimeout(c,5e3)),s.classList.add("hidden"),o.classList.remove("show"),await new Promise(c=>setTimeout(c,1e3)),o.classList.add("hidden"),l.classList.remove("li-style-active"),l.classList.add("li-style-complete","pointer-events-none"),l.querySelector("span").innerHTML=b(),await P(t,r,e)}async function S(t,o,s,i,l,r,e){try{if(l.classList.remove("hidden"),await _(t.new_files,t.content,"/")===!0){l.classList.add("hidden"),window.scrollTo({top:0,behavior:"smooth"}),o.classList.remove("show"),await new Promise(p=>setTimeout(p,500)),o.classList.add("hidden"),s.classList.remove("li-style-active"),s.classList.add("li-style-complete","pointer-events-none"),s.querySelector("span").innerHTML=b(),await new Promise(p=>setTimeout(p,500)),i.classList.add("li-style-active");const u=document.createElement("h2");u.classList.add("text-text","dark:text-text-dark"),u.textContent="Илья поработал и хочет спать!";const c=document.createElement("p");c.classList.add("dark:text-text-dark","font-medium"),c.textContent="Теперь можно посмотреть, папку с архивом за сегодняшнее число, туда положил все файлы!",r.appendChild(u),r.appendChild(c),r.classList.remove("hidden"),await new Promise(p=>setTimeout(p,100)),r.classList.add("show"),e.classList.remove("hidden"),await new Promise(p=>setTimeout(p,5e3)),e.classList.add("hidden"),r.classList.remove("show"),await new Promise(p=>setTimeout(p,500)),r.classList.add("hidden"),i.classList.remove("li-style-active"),i.classList.add("li-style-complete","pointer-events-none"),i.querySelector("span").innerHTML=b(),await new Promise(p=>setTimeout(p,1e3)),location.reload()}else l.classList.add("hidden"),console.error("Ошибка при сохранении изменений")}catch(L){l.classList.add("hidden"),e.classList.add("hidden"),console.error("Ошибка во время обработки:",L)}}async function j(t,o,s){const i=document.getElementById("upload-spinner"),l=document.getElementById("upload-spinner2"),r=document.getElementById("upload-spinner3"),e=document.getElementById("upload-spinner4"),L=document.getElementById("step2-form"),u=document.getElementById("step3-form"),c=document.getElementById("step4-form"),p=document.getElementById("save-edited-content"),a=document.getElementById("save-content"),n=document.querySelector('.step[data-step="3"]'),h=document.querySelector('.step[data-step="4"]');try{const m=new FormData(t);i.classList.remove("hidden");const y=await fetch(t.action,{method:"POST",body:m}),d=await y.json();if(!y.ok)throw new Error(d.error||`Ошибка: ${y.status}`);console.log("Ответ от сервера:",d),t.reset(),s(),o.classList.remove("show"),setTimeout(()=>o.classList.add("hidden"),500),await N(d,L,l),a.addEventListener("click",()=>{S(d,u,n,h,r,c,e)}),p.addEventListener("click",()=>{S(d,u,n,h,r,c,e)})}catch(m){M(m)}finally{i.classList.add("hidden")}}const{clearFileList:O}=q();function $(){const t=document.getElementById("step1-form"),o=document.getElementById("file-upload-form"),s=document.getElementById("files-label"),i=document.getElementById("files"),l=document.getElementById("start-number-label"),r=document.getElementById("start-number"),e=document.getElementById("device-type-label"),L=document.getElementById("device-type"),u=document.getElementById("files-error"),c=document.getElementById("start-number-error"),p=document.getElementById("device-type-error");document.getElementById("upload-spinner");const a=()=>{[u,c,p].forEach(d=>d.classList.add("hidden"))},n=(d,v,f,g="")=>{g&&(f.textContent=g),f.classList.remove("hidden"),d.classList.remove("correct_input"),d.classList.add("error_input"),v.classList.remove("correct_label"),v.classList.add("error_label"),setTimeout(()=>{f.classList.add("hidden"),d.classList.add("correct_input"),d.classList.remove("error_input"),v.classList.add("correct_label"),v.classList.remove("error_label")},3e3)},h=()=>{const d=[".doc",".docx",".rtf"];if(i.files.length===0)return n(i,s,u,"Загрузите хотя бы один файл."),!1;for(let v=0;v<i.files.length;v++){const f=i.files[v],g=f.name.slice((f.name.lastIndexOf(".")-1>>>0)+2).toLowerCase();if(!d.includes("."+g))return n(i,s,u,"Допустимые форматы: .doc, .docx, .rtf"),!1}return!0},m=()=>{const d=r.value.trim(),v=Number(d);return d===""||isNaN(v)||v<=0?(n(r,l,c,"Введите число больше нуля."),!1):!0},y=()=>L.value===""?(n(L,e,p,"Выберите тип устройства."),!1):!0;o.addEventListener("submit",d=>{d.preventDefault(),a(),h()&m()&y()&&j(o,t,O)})}document.addEventListener("DOMContentLoaded",()=>{$(),H(),q();const t=document.getElementById("a-main");t.classList.toggle("bg-accent"),t.classList.toggle("dark:bg-accent-dark");const o=document.getElementById("a-main-mob");o.classList.toggle("bg-accent"),o.classList.toggle("dark:bg-accent-dark")});
