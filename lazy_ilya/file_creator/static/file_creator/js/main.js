/* empty css        */function _(s,...n){n.forEach(t=>t.classList.remove("show")),setTimeout(()=>{n.forEach(t=>t.classList.add("hidden")),s.classList.remove("hidden"),setTimeout(()=>{s.classList.add("show")},100)},500)}function P(){const s=document.querySelectorAll(".step"),n={1:document.getElementById("step1-form"),2:document.getElementById("step2-form"),3:document.getElementById("step3-form"),4:document.getElementById("step4-form")};s.forEach(t=>{t.addEventListener("click",()=>{const i=t.dataset.step;s.forEach(e=>e.classList.remove("li-style-active")),t.classList.add("li-style-active");const a=n[i],d=Object.values(n).filter(e=>e!==a);a?_(a,...d):(Object.values(n).forEach(e=>e.classList.remove("show")),setTimeout(()=>{Object.values(n).forEach(e=>e.classList.add("hidden"))},500))})})}function A(){const s=document.getElementById("files"),n=document.getElementById("file-list"),t=document.getElementById("server-info"),i=document.getElementById("btn-div");let a=[];s.addEventListener("change",()=>{a=Array.from(s.files),d()});function d(){n.innerHTML="",a.forEach(m=>{const c=document.createElement("li");c.classList.add("flex","justify-between","items-center","gap-2","mb-1");const o=document.createElement("span");o.textContent=`${m.name} (${(m.size/1024).toFixed(1)} KB)`;const v=y();v.addEventListener("click",()=>{u(m)}),c.appendChild(o),c.appendChild(v),n.appendChild(c)}),e()}function e(){const m=new DataTransfer;a.forEach(c=>m.items.add(c)),s.files=m.files}function y(){const m=document.createElement("button");return m.type="button",m.innerHTML=`Удалить<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="shrink-0 inline size-3 md:size-5 ms-1">
  <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
</svg>
`,m.classList.add("btn-delete"),m}function u(m){t.classList.remove("hidden"),t.classList.add("flex","animate-popup"),t.querySelector("h3").textContent="Подтверждение удаления",t.querySelector("p").textContent=`Вы уверены, что хотите удалить файл "${m.name}"?`,i.innerHTML="";const c=document.createElement("button");c.id="confirm-delete",c.textContent="Да, Нах!",c.classList.add("btn-submit","!p-1","!font-medium");const o=document.createElement("button");o.id="cancel-delete",o.textContent="Передумал",o.classList.add("btn-cancel","!p-1","!font-medium"),i.appendChild(c),i.appendChild(o),c.addEventListener("click",()=>{const v=a.indexOf(m);v!==-1&&(a.splice(v,1),d()),l()}),o.addEventListener("click",l)}function l(){t.classList.remove("animate-popup"),t.classList.add("animate-popup-reverse"),setTimeout(()=>{t.classList.add("hidden"),t.classList.remove("flex","animate-popup-reverse"),t.querySelector("h3").textContent="",t.querySelector("p").textContent="",i.innerHTML=""},500)}function r(){a=[],n.innerHTML="",s.value=""}return{clearFileList:r}}let b=null;function H(s,n="server-error"){const t=document.getElementById(n);if(!t){console.warn(`Элемент с id "${n}" не найден.`);return}const i=t.querySelector("p");if(!i){console.warn(`В элементе с id "${n}" отсутствует <p> для текста ошибки.`);return}b&&clearTimeout(b),t.classList.remove("hidden","animate-popup-reverse"),t.classList.add("flex","animate-popup"),i.textContent=(typeof s=="string"?s:s.message)||"Произошла ошибка при отправке данных",t.scrollIntoView({behavior:"smooth",block:"start"}),console.error("Ошибка запроса:",s),b=setTimeout(()=>{t.classList.remove("animate-popup"),t.classList.add("animate-popup-reverse"),setTimeout(()=>{t.classList.add("hidden"),t.classList.remove("flex","animate-popup-reverse")},1e3),b=null},4e3)}function B(){return`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M15.59 14.37a6 6 0 0 1-5.84 7.38v-4.8m5.84-2.58a14.98 14.98 0 0 0 6.16-12.12A14.98 14.98 0 0 0 9.631 8.41m5.96 5.96a14.926 14.926 0 0 1-5.841 2.58m-.119-8.54a6 6 0 0 0-7.381 5.84h4.8m2.581-5.84a14.927 14.927 0 0 0-2.58 5.84m2.699 2.7c-.103.021-.207.041-.311.06a15.09 15.09 0 0 1-2.448-2.448 14.9 14.9 0 0 1 .06-.312m-2.24 2.39a4.493 4.493 0 0 0-1.757 4.306 4.493 4.493 0 0 0 4.306-1.758M16.5 9a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Z" />
</svg>
`}async function N(s,n,t){const i=document.getElementById("save-content");i.disabled=!0;const a=document.querySelector("[name=csrfmiddlewaretoken]").value,d={files:s,content:n};try{const e=await fetch(t,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRFToken":a},body:JSON.stringify(d)}),y=await e.json();if(!e.ok)throw new Error(y.error||`Ошибка: ${e.status}`);return console.log("Все изменения успешно сохранены:",y),!0}catch(e){return H(e,"server-error2"),!1}finally{i.disabled=!1}}async function j(s,n,t){const i=document.getElementById("save-edited-content"),a=document.getElementById("save-content"),d=document.getElementById("btn-div2"),e=document.getElementById("file-content"),y=document.getElementById("file-names-list");n.classList.add("li-style-active");let u=300;const l=new Map;let r=null,m=null,c=null;if(Array.isArray(s.new_files)&&Array.isArray(s.content)&&(s.new_files.forEach((o,v)=>{l.set(o,s.content[v])}),s.new_files.forEach((o,v)=>{const f=document.createElement("li");f.setAttribute("tabindex","0"),f.classList.add("focus:outline-none","focus:ring-2","focus:ring-[--color-accent]"),f.classList.add("file-item","group","group-focus:outline-none","group-focus:ring-2","group-focus:ring-[--color-accent]");const p=document.createElement("span");p.textContent=o,p.classList.add("file-name","cursor-pointer","group-hover:text-[--color-accent]"),f.addEventListener("keydown",g=>{g.key==="Tab"&&f.click()}),f.addEventListener("click",()=>{t.scrollIntoView({behavior:"smooth",block:"start"}),e.value=l.get(o),e.disabled=!1,e.style.height="auto",u=e.scrollHeight,e.style.height=u+"px",i.disabled=!1,a.disabled=!1,document.querySelectorAll(".file-item").forEach(g=>g.classList.remove("file-item-selected")),f.classList.add("file-item-selected"),c=o});const L=document.createElement("button");L.title="Удалить",L.innerHTML=`
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                     stroke="currentColor" class="shrink-0 inline size-4 md:size-5 me-1">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                </svg>
                Удалить`,L.classList.add("opacity-0","btn-delete","!w-4/10","flex","group-hover:opacity-100","justify-center","items-center","!py-1"),L.addEventListener("click",g=>{g.stopPropagation();const h=document.getElementById("server-info2"),C=document.getElementById("btn-div");h.classList.remove("hidden"),t.scrollIntoView({behavior:"smooth",block:"start"}),h.classList.add("flex","animate-popup"),h.querySelector("h3").textContent=`Удалить файл "${o}"?`,h.querySelector("p").textContent="Это действие нельзя отменить.";const T=document.getElementById("confirm-delete");T&&T.remove();const k=document.getElementById("cancel-delete");k&&k.remove();const w=document.createElement("button");w.id="confirm-delete",w.textContent="Да, Нах!",w.classList.add("btn-submit","!p-1","!font-medium");const E=document.createElement("button");E.id="cancel-delete",E.textContent="Передумал",E.classList.add("btn-cancel","!p-1","!font-medium"),d.appendChild(w),d.appendChild(E),w.addEventListener("click",()=>{const x=s.new_files.indexOf(o);if(x!==-1&&(s.new_files.splice(x,1),s.content.splice(x,1)),l.delete(o),f.remove(),c===o){const I=document.querySelectorAll(".file-item");if(I.length>0){const S=I[Math.min(x,I.length-1)],q=S.querySelector(".file-name").textContent;c=q,e.value=l.get(q)||"",e.disabled=!1,e.style.height="auto",u=e.scrollHeight,e.style.height=u+"px",document.querySelectorAll(".file-item").forEach(F=>F.classList.remove("file-item-selected")),S.classList.add("file-item-selected")}else c=null,e.value="",e.disabled=!0,e.style.height="auto",e.style.height="2.5rem",a.disabled=!0,i.disabled=!0}h.classList.remove("animate-popup"),h.classList.add("animate-popup-reverse"),setTimeout(()=>{h.classList.add("hidden"),h.classList.remove("flex","animate-popup-reverse"),h.querySelector("h3").textContent="",h.querySelector("p").textContent="",C.innerHTML=""},500)}),E.addEventListener("click",()=>{h.classList.remove("animate-popup"),h.classList.add("animate-popup-reverse"),setTimeout(()=>{h.classList.add("hidden"),h.classList.remove("flex","animate-popup-reverse"),h.querySelector("h3").textContent="",h.querySelector("p").textContent="",C.innerHTML=""},500)})}),f.appendChild(p),f.appendChild(L),y.appendChild(f),v===0&&(r=o,m=f,c=o)})),await new Promise(o=>setTimeout(o,500)),t.classList.remove("hidden"),await new Promise(o=>setTimeout(o,100)),t.classList.add("show"),r){e.value=l.get(r),e.disabled=!1,e.style.height="auto",u=e.scrollHeight,e.style.height=u+"px",e.blur();const o=document.getElementById("save-edited-content");o.disabled=!1,a.disabled=!1,document.querySelectorAll(".file-item").forEach(v=>v.classList.remove("file-item-selected")),m.classList.add("file-item-selected")}e.addEventListener("input",()=>{if(c){const o=window.scrollY;e.style.height="auto",e.style.height=e.scrollHeight+"px",window.scrollTo({top:o});const v=e.value;l.set(c,v);const f=s.new_files.indexOf(c);f!==-1&&(s.content[f]=v)}}),await new Promise(o=>setTimeout(o,3e3))}async function O(s,n,t){const i=document.querySelector('.step[data-step="1"]'),a=document.querySelector('.step[data-step="2"]'),d=document.querySelector('.step[data-step="3"]'),e=document.getElementById("step3-form");i.classList.remove("li-style-active"),i.classList.add("li-style-complete","pointer-events-none"),i.querySelector("span").innerHTML=B(),a.classList.add("li-style-active");const y=document.createElement("h2");y.textContent="Илья читает, что ты написал";const u=document.createElement("p");if(u.classList.add("text-text","dark:text-text-dark"),u.textContent="Посмотри правильно ли Илья прочитал. Получены обработанные файлы, ниже приведены их названия.",Array.isArray(s.new_files)){const l=document.createElement("ul");l.className="list-disc pl-5 mt-2 text-sm md:text-base text-text dark:text-text-dark font-medium",s.new_files.forEach(r=>{const m=document.createElement("li");m.textContent=r,l.appendChild(m)}),n.appendChild(y),n.appendChild(u),n.appendChild(l)}await new Promise(l=>setTimeout(l,500)),n.classList.remove("hidden"),await new Promise(l=>setTimeout(l,100)),n.classList.add("show"),t.classList.remove("hidden"),await new Promise(l=>setTimeout(l,5e3)),t.classList.add("hidden"),n.classList.remove("show"),await new Promise(l=>setTimeout(l,1e3)),n.classList.add("hidden"),a.classList.remove("li-style-active"),a.classList.add("li-style-complete","pointer-events-none"),a.querySelector("span").innerHTML=B(),await j(s,d,e)}async function M(s,n,t,i,a,d,e){try{if(a.classList.remove("hidden"),await N(s.new_files,s.content,"/")===!0){a.classList.add("hidden"),window.scrollTo({top:0,behavior:"smooth"}),n.classList.remove("show"),await new Promise(r=>setTimeout(r,500)),n.classList.add("hidden"),t.classList.remove("li-style-active"),t.classList.add("li-style-complete","pointer-events-none"),t.querySelector("span").innerHTML=B(),await new Promise(r=>setTimeout(r,500)),i.classList.add("li-style-active");const u=document.createElement("h2");u.classList.add("text-text","dark:text-text-dark"),u.textContent="Илья поработал и хочет спать!";const l=document.createElement("p");l.classList.add("dark:text-text-dark","font-medium"),l.textContent="Теперь можно посмотреть, папку с архивом за сегодняшнее число, туда положил все файлы!",d.appendChild(u),d.appendChild(l),d.classList.remove("hidden"),await new Promise(r=>setTimeout(r,100)),d.classList.add("show"),e.classList.remove("hidden"),await new Promise(r=>setTimeout(r,5e3)),e.classList.add("hidden"),d.classList.remove("show"),await new Promise(r=>setTimeout(r,500)),d.classList.add("hidden"),i.classList.remove("li-style-active"),i.classList.add("li-style-complete","pointer-events-none"),i.querySelector("span").innerHTML=B(),await new Promise(r=>setTimeout(r,1e3)),location.reload()}else a.classList.add("hidden"),console.error("Ошибка при сохранении изменений")}catch(y){a.classList.add("hidden"),e.classList.add("hidden"),console.error("Ошибка во время обработки:",y)}}async function $(s,n,t){const i=document.getElementById("upload-spinner"),a=document.getElementById("upload-spinner2"),d=document.getElementById("upload-spinner3"),e=document.getElementById("upload-spinner4"),y=document.getElementById("step2-form"),u=document.getElementById("step3-form"),l=document.getElementById("step4-form"),r=document.getElementById("save-edited-content"),m=document.getElementById("save-content"),c=document.querySelector('.step[data-step="3"]'),o=document.querySelector('.step[data-step="4"]');try{const v=new FormData(s);i.classList.remove("hidden");const f=await fetch(s.action,{method:"POST",body:v}),p=await f.json();if(!f.ok)throw new Error(p.error||`Ошибка: ${f.status}`);console.log("Ответ от сервера:",p),s.reset(),t(),n.classList.remove("show"),setTimeout(()=>n.classList.add("hidden"),500),await O(p,y,a),m.addEventListener("click",()=>{M(p,u,c,o,d,l,e)}),r.addEventListener("click",()=>{M(p,u,c,o,d,l,e)})}catch(v){H(v)}finally{i.classList.add("hidden")}}const{clearFileList:z}=A();function V(){const s=document.getElementById("step1-form"),n=document.getElementById("file-upload-form"),t=document.getElementById("files-label"),i=document.getElementById("files"),a=document.getElementById("start-number-label"),d=document.getElementById("start-number"),e=document.getElementById("device-type-label"),y=document.getElementById("device-type"),u=document.getElementById("files-error"),l=document.getElementById("start-number-error"),r=document.getElementById("device-type-error");document.getElementById("upload-spinner");const m=()=>{[u,l,r].forEach(p=>p.classList.add("hidden"))},c=(p,L,g,h="")=>{h&&(g.textContent=h),g.classList.remove("hidden"),p.classList.remove("correct_input"),p.classList.add("error_input"),L.classList.remove("correct_label"),L.classList.add("error_label"),setTimeout(()=>{g.classList.add("hidden"),p.classList.add("correct_input"),p.classList.remove("error_input"),L.classList.add("correct_label"),L.classList.remove("error_label")},3e3)},o=()=>{const p=[".doc",".docx",".rtf"];if(i.files.length===0)return c(i,t,u,"Загрузите хотя бы один файл."),!1;for(let L=0;L<i.files.length;L++){const g=i.files[L],h=g.name.slice((g.name.lastIndexOf(".")-1>>>0)+2).toLowerCase();if(!p.includes("."+h))return c(i,t,u,"Допустимые форматы: .doc, .docx, .rtf"),!1}return!0},v=()=>{const p=d.value.trim(),L=Number(p);return p===""||isNaN(L)||L<=0?(c(d,a,l,"Введите число больше нуля."),!1):!0},f=()=>y.value===""?(c(y,e,r,"Выберите тип устройства."),!1):!0;n.addEventListener("submit",p=>{p.preventDefault(),m(),o()&v()&f()&&$(n,s,z)})}document.addEventListener("DOMContentLoaded",()=>{V(),P(),A();const s=document.getElementById("a-main");s.classList.toggle("bg-accent"),s.classList.toggle("dark:bg-accent-dark");const n=document.getElementById("a-main-mob");n.classList.toggle("bg-accent"),n.classList.toggle("dark:bg-accent-dark")});
